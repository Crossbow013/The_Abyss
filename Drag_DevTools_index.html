<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="viewport" content="user-scalable=no">
        <link rel="icon" href="icon/icon.png" type="image/png">
        <link rel="apple-touch-icon" href="icon/icon.png">
        <link rel="stylesheet" type="text/css" href="css/game.css">
		<style type="text/css">		

			:root {
				--background-color: #ffffff;
				--color: #000000;
				--color-alpha-03: #0000001a;
			}

			html {
				overflow-y: scroll;
			}
			
			body {
				margin: 0;
				background-color: var(--background-color); 
				color: var(--color); 
				width: auto; 
				height: auto;
			}
			
			body::-webkit-scrollbar {
			  width: 20px;
			  color: rebeccapurple;
			}

			body::-webkit-scrollbar-track {
			  background-color: var(--background-color);
			  border-radius: 100px;
			}

			body::-webkit-scrollbar-thumb {
			  border-radius: 100px;
			  border: 5px solid transparent;
			  background-clip: content-box;
			  background-color: #8070d4;
			}
			
			button {
				color: var(--color);
				background: var(--background-color);
				border-color: var(--color);
				padding: 2px 5px;
				border-radius: 5px;
			}
			
			button:disabled {
				color: dimgrey;
				border-color: dimgray;
			}
			
			#menu {
				box-shadow: 0 2px 15px 5px rgb(0 0 0 / 75%);
				border-bottom: 2px solid rebeccapurple;
				z-index: 50;
				transition: all .5s cubic-bezier(0.06, 0.57, 0.24, 1.04);
			}
			
			#menu.fixed {
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
			}
			
			form.fixed {
				position: fixed;
				top: 32px;
				left: 0;
				right: 0;
				background: white;
				border-bottom: 2px solid black;
				margin: 0px;
				padding: 5px;
				z-index: 50;
			}
			
			.openMenu {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				height: auto;
				opacity: 255;
				text-align: center;
				background: var(--background-color);
				color: var(--color); 
				transition: all 0s linear;
				cursor: pointer;
				overflow: hidden;
				font-weight: bold;
				font-family: cursive;
				font-size: 22px;
				display: flex;
				display: -ms-flexbox;
				display: -webkit-flex;
				display: flex;
				-webkit-flex-direction: row;
				-ms-flex-direction: row;
				flex-direction: row;
				-webkit-flex-wrap: wrap;
				-ms-flex-wrap: wrap;
				flex-wrap: wrap;
				-webkit-justify-content: center;
				-ms-flex-pack: center;
				justify-content: center;
				-webkit-align-content: center;
				-ms-flex-line-pack: center;
				align-content: center;
				-webkit-align-items: center;
				-ms-flex-align: center;
				align-items: center;
			}
			
			#menu:hover .openMenu {
				opacity: 0;
				visibility: hidden;
				transition: all .5s cubic-bezier(0.06, 0.57, 0.24, 1.04);
			}
			
			.openMenu > span {
				-webkit-order: 0;
				-ms-flex-order: 0;
				order: 0;
				-webkit-flex: 0 1 auto;
				-ms-flex: 0 1 auto;
				flex: 0 1 auto;
				-webkit-align-self: auto;
				-ms-flex-item-align: auto;
				align-self: auto;
			}
			
			#menu .submenus {
				opacity: 0;
				visibility: hidden;
				background: var(--background-color);
				color: var(--color); 
				display: grid;
				grid-template-columns: repeat(4, 1fr);
				grid-template-rows: auto;
				grid-column-gap: 0px;
				grid-row-gap: 0px;
				overflow: hidden;
				max-height: 30px;
				transition: all 0s linear;
			}
			
			#menu:hover .submenus {
				max-height: 76px;
				visibility: visible;
				opacity: 255;
				transition: clip .5s cubic-bezier(0.06, 0.57, 0.24, 1.04);
			}
			
			#menu .submenus .submenu {
				align-self: center;
				text-align: center;
				font-weight: bold;
				cursor: pointer;
				padding: 10px 0px;
				position: relative;
				transition: all 0s linear;
				opacity: 0;
			}
			
			#menu:hover .submenus .submenu {
				opacity: 255;
				transition: all .5s cubic-bezier(0.06, 0.57, 0.24, 1.04);
			}
			
			#menu .submenus .submenu::before {
				content: '';
				position: absolute;
				bottom: 0px;
				left: 0;
				width: 100%;
				height: 1px;
				background-image: linear-gradient(90deg, transparent, rebeccapurple, transparent);
				opacity: 255;
			}
			
			#menu .submenus .submenu::after {
				content: '';
				position: absolute;
				top: 0px;
				right: 0;
				width: 1px;
				height: 100%;
				background-image: linear-gradient(45deg, transparent, rebeccapurple, transparent);
				opacity: 255;
			}
			
			#menu .submenus .submenu span {
				position: relative;
				transition: all .3s linear;
			}
			
			#menu .submenus .submenu:hover span, #menu .subMenuSelected span {
				text-shadow: 4px 4px 10px rgba(0, 0, 0, 0.7);
			}

			#menu .submenus .submenu span::after {
				content: '';
				position: absolute;
				bottom: -3px;
				left: 0;
				width: 100%;
				height: 2px;
				background-color: rebeccapurple;
				opacity: 255;
				transition: opacity .3s, transform .3s;
				box-shadow: 4px 4px 2px 0px rgba(0, 0, 0, 0.7);
				transform-origin: center;
				transform: scale(0);
			}

			#menu .submenus .submenu:hover span::after,
			#menu .submenus .submenu:focus span::after, 
			#menu .submenus .subMenuSelected span::after,
			#menu .submenus .subMenuSelected span::after {
				transform: scale(1);
			}
			
			#lightMode {
				font-size: 25px;
				position: fixed;
				bottom: -65px;
				right: -65px;
				width: 100px;
				height: 100px;
				border-radius: 50%;
				border: 2px solid rebeccapurple;
				background: var(--background-color);
				opacity: 75%;
				cursor: pointer;
				color: var(--color);
				z-index: 50;
				transition: all .5s cubic-bezier(0.26, 0.8, 0.26, 0.79);
			}
			
			#lightMode:hover {
				bottom: -50px;
				right: -50px;
				opacity: 100%;
			}
			
			#lightMode span {
				position: absolute;
				font-size: 25px;
				transform-origin: bottom right 60px;
				transition: all .5s linear;
			}
			
			#lightMode:hover span {
				font-size: 35px;
			}
			
			#lightMode span:first-child {
				right: 67px;
				bottom: 60px;
			}
			
			#lightMode span:nth-child(2) {
				right: 63px;
				bottom: 60px;
			}
			
			#lightMode:hover span:first-child {
				right: 60px;
				bottom: 47px;
			}
			
			#lightMode:hover span:nth-child(2) {
				right: 52px;
				bottom: 47px;
			}
			
			#lightMode[data-lightMode="light"] span:first-child {
				transform: rotate(0deg);
			}
			
			#lightMode[data-lightMode="light"] span:nth-child(2) {
				transform: rotate(180deg);
			}
			
			#lightMode[data-lightMode="dark"] span:first-child {
				transform: rotate(-180deg);
			}
			
			#lightMode[data-lightMode="dark"] span:nth-child(2) {
				transform: rotate(0deg);
			}
			
			#view {
				margin-top: 32px;
			}

			h1 {
				padding-block-start: 0.67em;
				padding-block-end: 0.67em;
				background-color: steelblue;
				margin: 0;
				padding-left: 10px;
				border-bottom: 2px rebeccapurple solid;
			}
			
			h2 {
				padding: 5px 10px;
				text-align: center;
				margin: 0;
				background-color: rgb(70 130 180 / 0.5);
				border-top: 1px black solid;
				border-bottom: 1px black solid;
			}
			
			.showInfoTooltip {
				border-radius: 20px;
				border: 2px black solid;
				padding: 0px;
				width: 30px;
				height: 30px;
				line-height: 30px;
				display: inline-block;
				text-align: center;
				background: rgba(255, 255, 255, 0.75);
				cursor: pointer;
				color: black;
			}
			
			.info {
				border: 2px var(--color) solid;
				position: absolute;
				background: var(--background-color);
				color: var(--color);
				border-radius: 10px;
				z-index: 100;
				top: 95px;
				left: 10px;
				right: 10px;
				padding: 0px 5px;
				transition: all 0.25s linear;
			}
			
			form {
				display: grid;
				place-content: center start;
				min-height: 50px;
				margin-left: 10px;
				grid-template-columns: repeat(1, 1fr);
				gap: 1em;
			}

			.form-control {
				font-family: system-ui, sans-serif;
				font-size: 16px;
				font-weight: bold;
				line-height: 1.1;
				display: grid;
				grid-template-columns: 1em auto;
				gap: 0.5em;
			}
			
			.form-control-right {
				font-family: system-ui, sans-serif;
				font-size: 16px;
				font-weight: bold;
				line-height: 1.1;
				display: grid;
				grid-template-columns: auto 1.4em;
				gap: 0.5em;
				text-align: right;
			};
			
			.form-control-text {
				font-family: system-ui, sans-serif;
				font-size: 22px;
				font-weight: bold;
				line-height: 1.1;
				display: grid;
				// grid-template-columns: auto;
				gap: 0.3em;
			}
			
			.form-control-text input[type="text"] {
				width: 80%;
				margin: auto;
			}
			
			.form-control-filter {
				font-family: system-ui, sans-serif;
				font-size: 16px;
				font-weight: bold;
				line-height: 1.1;
				display: grid;
				grid-template-columns: 1fr 4fr 0.5fr;
				gap: 0.5em;
			}
			
			.form-control-filter > span {
				margin-top: 0.5em;
			}

			input[type="checkbox"] {
				-webkit-appearance: none;
				appearance: none;
				margin: 0;
				font: inherit;
				color: rebeccapurple;
				width: 1.15em;
				height: 1.15em;
				border: 0.15em solid currentColor;
				border-radius: 0.15em;
				transform: translateY(-0.075em);
				display: grid;
				place-content: center;
			}

			input[type="checkbox"]::before {
				content: "";
				width: 0.65em;
				height: 0.65em;
				clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
				transform: scale(0);
				transform-origin: bottom left;
				transition: 120ms transform ease-in-out;
				box-shadow: inset 1em 1em rebeccapurple;
				background-color: CanvasText;
			}

			input[type="checkbox"]:checked::before {
				transform: scale(1);
			}

			input[type="checkbox"]:focus {
				outline: max(2px, 0.15em) solid currentColor;
				outline-offset: max(2px, 0.15em);
			}

			input[type="checkbox"]:disabled {
				color: #959495;
				cursor: not-allowed;
			}

			input[type="text"], input[type="number"] {
				font-size: 16px;
				font-size: Max(16px, 1em);
				font-family: inherit;
				padding: 0.25em 0.5em;
				background: var(--background-color);
				color: var(--color);
				border: 2px solid var(--color);;
				border-radius: 4px;
				box-sizing: border-box;
				width: 100%;
				transition: 180ms box-shadow ease-in-out;
			}

			input[type="text"]:focus, input[type="number"]:focus {
				border-color: hsl(245, 100%, 42%);
				box-shadow: 0 0 0 3px hsla(245, 100% calc(42% + 40%), 0.8);
				outline: 3px solid transparent;
				border: 2px solid rebeccapurple;
				FONT-WEIGHT: 200;
			}
			
			input[type="text"]:disabled, input[type="number"]:disabled, select:disabled {
				text-indent: -100%;
				white-space: nowrap;
				overflow: hidden;
				cursor: not-allowed;
				border-color: dimgrey;
			}
			
			input[type="radio"] {
				-webkit-appearance: none;
				appearance: none;
				background-color: var(--background-color);
				margin: 0;
				font: inherit;
				color: currentColor;
				width: 22px;
				height: 22px;
				border: 0.15em solid currentColor;
				border-radius: 50%;
				transform: translateY(-0.075em);
				display: inline-block;
				place-content: center;
			}

			input[type="radio"]::before {
				content: "";
				width: 14px;
				height: 14px;
				border-radius: 50%;
				transform: translate(-50%, -50%) scale(0);
				transition: 120ms transform ease-in-out;
				box-shadow: inset 1em 1em rebeccapurple;
				background-color: CanvasText;
				display: grid;
				position: absolute;
				left: 50%;
				top: 50%;
			}

			input[type="radio"]:checked::before {
				transform: translate(-50%, -50%) scale(1);
			}

			input[type="radio"]:focus {
				outline: none;
				outline-offset: 0;
				border-radius: 50%;
				border: 2px solid rebeccapurple;
			}
			
			input[type="radio"]:disabled {
				border-color: dimgrey;
			}
			
			input[type="radio"]:disabled ~ label {
				color: dimgrey;
			}
			
			select {
				appearance: none;
				background-color: transparent;
				border: none;
				padding: 0.2em 1em 1px 0;
				margin: 0;
				width: 100%;
				font-family: inherit;
				font-size: inherit;
				cursor: inherit;
				line-height: inherit;
				z-index: 1;
				outline: none;
				color: var(--color);
			}
			
			option {
				color: var(--color);
				background: var(--background-color);
			}

			.select {
				display: grid;
				grid-template-areas: "select";
				align-items: center;
				position: relative;
				border: 1px solid var(--color);
				border-radius: 0.25em;
				padding: 0.25em 0.5em;
				cursor: pointer;
				line-height: 1.1;
				background-color: var(--background-color);
			}
			
			select, .select::after {
				grid-area: select;
			}
			
			.select::after {
				content: "";
				justify-self: end;
				width: 0.8em;
				height: 0.5em;
				background-color: var(--color);
				clip-path: polygon(100% 0%, 0 0%, 50% 100%);
			}
			
			.select.disabled::after {
				display: none;
			}

			select:focus + .focus {
				position: absolute;
				top: 0px;
				left: 0px;
				right: 0px;
				bottom: 0px;
				border: 0px solid rebeccapurple;
				border-radius: 0;
			}
			
			ul {
				padding: 0;
			}
			
			.evData {
				margin-bottom: 1em;
			}
			
			.circle {
				width: 1.16em;
				border-radius: 50%;
				border: .25em solid rgb(70 130 180);
				background: #000;
				color: #fff;
				font-family: arial;
				font-weight: bold;
				text-align: center;
				display: inline-block;
			}
			
			.square {
				height: 0.4em;
				padding: .35em;
				padding-bottom: 0.75em;
				padding-top: 0.1em;
				border: .2em solid rgb(0 0 0 / 0.7);
				background: rgb(0 0 0 / 0.6);
				color: #fff;
				font-family: arial;
				font-weight: bold;
				text-align: center;
				display: inline-block;
				box-shadow: inset black 0px 0px 20px 3px;
			}
			
			.squareTitle {
				height: 0.4em;
				padding: .35em;
				padding-bottom: 0.75em;
				padding-top: 0.1em;
				border: .15em solid rgb(0 0 0 / 0.7);
				background: rgb(0 0 0 / 0.1);
				font-family: arial;
				font-weight: bold;
				text-align: center;
				display: inline-block;
				color: black;
			}
			
			.squareSubTitle {
				padding: 0 0.35em;
				padding-top: 0.1em;
				font-family: arial;
				font-weight: bold;
				text-align: center;
				display: inline-block;
				color: var(--color);
			}
			
			.hidden {
				display: none !important;
			}
			
			.invisible {
				visibility : hidden;
			}
			
			.uncollapsed {
				visibility: hidden;
				opacity: 0;
				height: 0;
				margin: 0 0 0 0;
				margin-bottom: 0 !important;
				margin-top: 0 !important;
				transition: all 0s linear !important;
			}
			
			.customGrid {
				display: grid;
				grid-template-columns: repeat(var(--grid-col-nb), 1fr);
				grid-template-rows: repeat(var(--grid-row-nb), 1fr);
			}
			
			.gridColMinMax {
				display: grid;
				grid-template-columns: min-content max-content;
			}
			
			.grid2col {
				display: grid;
				grid-template-columns: repeat(2, 1fr);
				grid-template-rows: 2fr;
				grid-column-gap: 0px;
				grid-row-gap: 0px;
				place-content: start start;
				transition: all 0.25s linear;
			}
			
			.grid2 {
				display: grid;
				grid-template-columns: 0.9fr 3fr;
				grid-template-rows: 1fr;
				grid-column-gap: 0px;
				grid-row-gap: 0px;
				margin-left: -5px;
			}
			
			.grid2row {
				display: grid;
				grid-template-columns: 1fr;
				grid-column-gap: 0px;
				grid-row-gap: 0;
				grid-template-rows: 3em 2fr;
				margin: auto;
			}
			
			.gridColGap5 {
				display: grid;
				grid-column-gap: 5px;
			}
			
			.gridGap10 {
				display: grid;
				grid-row-gap: 10px;
			}
			
			.gridGap15 {
				display: grid;
				grid-row-gap: 15px;
			}
			
			.divider {
				display: block;
				margin: 25px 0 -17px;
				width: 100%;
				height: 0.2em;
				border: 0;
				background-color: rebeccapurple;
			}
			
			.divider + h3 {
				display: inline-block;
				position: relative;
				box-shadow: inset 0 0 0 0.1em rgba(0, 0, 0, 1);
				letter-spacing: .07em;
				background-color: var(--background-color);
				border: 0.05em solid var(--color);
			}
			
			.divider2 {
				display: block;
				margin: 25px 0 -12px;
				width: 100%;
				height: 1px;
				border: 0;
				background: rebeccapurple;
				background: linear-gradient(90deg, rgba(2,0,36,0) 0%, rebeccapurple 30%, rebeccapurple 70%, rgba(0,0,0,0) 100%);
			}
			
			.divider2 + h4 {
				display: inline-block;
				position: relative;
				letter-spacing: .07em;
				background-color: var(--background-color);
			}
			
			.divider3 {
				display: block;
				margin: 20px 0 -31px;
				width: 100%;
				height: 20px;
				border: 0;
				background: linear-gradient(90deg, rgba(2,0,36,0) 0%, red 30%, red 70%, rgba(0,0,0,0) 100%);
			}
			
			.divider3 + h4 {
				display: inline-block;
				position: relative;
				letter-spacing: .07em;
				background: var(--background-color);
				color: var(--color);
				box-shadow: inset 0 0 0px 1px black;
				height: 30px;
				border: solid 1px black;
				padding: 6px;
				border-radius: 5px;
			}
			
			.dividerVar {
				display: block;
				margin: 30px 0 -17px;
				width: 100%;
				height: 2px;
				border: 0;
				background-color: var(--color);
				background-image: linear-gradient(90deg, var(--background-color) 0%, transparent 30%, transparent 70%, var(--background-color) 100%);
			}
			
			.animationVariableInput {
				background: rebeccapurple;
			}
			
			.animationVariableInput .squareTitle {
				border-color: rebeccapurple;
			}
			
			.animationVariableInput input {
				border-color: rebeccapurple;
			}
			
			.dividerVar + h4 {
				display: inline-block;
				position: relative;
				letter-spacing: .07em;
			}
			
			.var, .var .squareTitle {
				transition: all .5s cubic-bezier(0.45, 0.68, 0.45, 0.69);
				background-image: linear-gradient(90deg, var(--background-color) 0%, transparent 30%, transparent 70%, var(--background-color) 100%);
			}
			
			.grid3 {
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				grid-template-rows: 1fr;
				grid-column-gap: 5px;
				grid-row-gap: 0px;
			}
			
			.grid4 {
				grid-template-columns: repeat(4, 1fr);
				grid-gap: 0px;
				grid-auto-rows: minmax(50px, auto);
				grid-auto-columns: minmax(100px, auto);
				display: grid;
				grid-gap: 0.3em;
			}
			
			#content {
				margin-left: 0.3em;
			}

			#content .vartest {
				border: 2px solid black;
				border-radius: 5px;
				cursor: pointer;
				text-align: center;
				line-height: 20px;
				font-size: 18px;
				transition: all 0.25s linear;
				overflow: hidden;
				display: grid;
				grid-template-columns: 1fr;
				grid-template-rows: 1fr 1fr;
				grid-column-gap: 0px;
				grid-row-gap: 0.5em;
				padding-bottom: 0.5em;
			}
			
			#content > .form-control-text > span:first-child {
				background-color: rgba(0, 0, 0, 0.7);
				padding: 5px 0px;
			}
			
			.varHeader {
				background-color: rgba(0, 0, 0, 0.3);
				border-bottom: .1em solid black;
				color: #fff;
			}
			
			.switchOn h4 {
				box-shadow: inset 0 0 0px 1px forestgreen;
			}
			
			.switchOn .divider3 {
				background: linear-gradient(90deg, rgba(2,0,36,0) 0%, forestgreen 30%, forestgreen 70%, rgba(0,0,0,0) 100%);
			}
			
			.switchOff h4 {
				box-shadow: inset 0 0 0px 1px red;
			}
			
			.switchOff .divider3 {
				background: linear-gradient(90deg, rgba(2,0,36,0) 0%, #b50e0e 30%, #b50e0e 70%, rgba(0,0,0,0) 100%);
			}
			
			.switch .switchId {
				position: absolute;
				left: -16px;
				top: -13px;
				background: var(--background-color);
				color: var(--color);
				padding: 2px;
				border: 1px solid var(--color);
				font-size: 11px;
				border-radius: 3px;
			}
			
			.switch .switchName {
				letter-spacing: normal;
				position: absolute;
				right: -16px;
				top: -13px;
				background: var(--background-color);
				color: var(--color);
				padding: 2px;
				border: 1px solid var(--color);
				font-size: 11px;
				border-radius: 3px;
			}
			
			.var .varId {
				position: absolute;
				right: 20px;
				top: -13px;
				background: var(--background-color);
				color: var(--color);
				padding: 2px;
				border: 1px solid var(--color);
				font-size: 11px;
				border-radius: 3px;
			}
			
			.var .varName {
				letter-spacing: normal;
				position: absolute;
				left: -5px;
				top: -13px;
				background: var(--background-color);
				color: var(--color);
				padding: 2px;
				border: 1px solid var(--color);
				font-size: 11px;
				border-radius: 3px;
			}
			
			.var .val {
				width: 90%;
				padding-right: 0;
			}
			
			.selfSwitch > span {
				transition: all .5s cubic-bezier(0.22, 0.61, 0.36, 1);
			}
			
			.selfSwitch > span > span {
				transition: all .5s cubic-bezier(0.4, 0, 1, 1);
			}
			
			.selfSwitchOn > span {
				background-color: forestgreen;
				background-image: linear-gradient(90deg, var(--background-color) 0%, transparent 50%, transparent 50%, var(--background-color) 100%);
			}
			
			.selfSwitchOn > span > span {
				border: .2em solid rgb(34 139 34 / 75%);
			}
			
			.selfSwitchOff > span {
				background-color: darkred;
				background-image: linear-gradient(90deg, var(--background-color) 0%, transparent 50%, transparent 50%, var(--background-color) 100%);
			}
			
			.selfSwitchOff > span > span {
				border: .2em solid rgb(139 0 0 / 0.75);
			}
			
			.wrapInputFilter:after {
				content: attr(data-after);
				position: absolute;
				right: 1px;
				padding-bottom: 1px;
				top: 5px;
				width: 70px;
				font-size: 11px;
				color: dimgrey;
				font-weight: normal;
				overflow: hidden;
				height: 22px;
				text-align: center;
				pointer-events: none;
			}
			
			.wrapInputFilterRight:after {
				content: attr(data-after);
				position: absolute;
				left: 37px;
				padding-bottom: 1px;
				top: 50%;
				width: 70px;
				font-size: 11px;
				transform: translateY(-50%);
				color: dimgrey;
				font-weight: normal;
				overflow: hidden;
				height: 22px;
				text-align: center;
				pointer-events: none;
			}
			
			.wrapInputFilter.disabled:after, .wrapInputFilterRight.disabled:after {
				display: none;
			}
			
			.wrapInputFilter.disabled, .wrapInputFilterRight.disabled {
				border: none !important;
			}
			
			.selectFiltered {
				position: absolute; 
				right: 0; 
				left: 0px; 
				top: 33px; 
				background: white; 
				border: 1px solid black; 
				padding-top: 0px;
				padding-bottom: 0px;
				box-shadow: 3px 3px 20px 2px rgb(0 0 0 / 70%);
				display: none;
				z-index: 2;
			}
			
			.selectFilteredOption {
				text-align: left;
				display: block;
				list-style: none;
				padding: 3px 0px;
				margin: 0;
				margin-right: -100%;
				font-size: 14px;
				font-weight: bold;
			}
			
			.selectFilteredOption.bgRed:checked {
				background: #b50e0e linear-gradient(0deg, #b50e0e 0%, #b50e0e 100%);
			}
			
			.selectFilteredOption.bgGreen:checked {
				background: forestgreen linear-gradient(0deg, forestgreen 0%, forestgreen 100%);
			}
			
			.helpAutoEvStuck, .eventCommandData {
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: rgba(0, 0, 0, 0.7) !important;
				z-index: 1000;
			}
			
			.helpAutoEvStuck > div, .eventCommandData > div {
				padding: 10px;
				background: var(--background-color);
				color: var(--color);
				border: 1px solid var(--color);
				z-index: 1001;
				position: fixed;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
				width: 75%;
				position: relative;
			}
			
			.helpAutoEvStuck > div:after, .eventCommandData > div:after {
				content: "";
				position: fixed;
				top: -15px;
				right: -15px;
				background: white;
				padding: 5px;
				border-radius: 50%;
				border: 2px solid rebeccapurple;
				color: rebeccapurple;
				font-weight: bold;
				font-size: 25px;
				height: 10px;
				width: 10px;
				padding-left: 10px;
				padding-bottom: 10px;
			}
			
			.helpAutoEvStuck > div:before, .eventCommandData > div:before {
				content: "\00d7";
				position: fixed;
				top: -13px;
				right: -8px;
				background: transparent;
				color: rebeccapurple;
				font-weight: bold;
				font-size: 25px;
				z-index: 1002;
				line-height: 27px;
			}
			
			.closeHelpAutoEvStuck, .closeEventCommandData {
				position: fixed;
				top: -20px;
				right: -20px;
				width: 40px;
				height: 40px;
				cursor: pointer;
				z-index: 1003;
			}
			
			.toggle[type="checkbox"] {
				-webkit-appearance: none;
				-moz-appearance: none;
				appearance: none;
				width: 62px;
				height: 32px;
				display: inline-block;
				position: relative;
				border-radius: 50px;
				overflow: hidden;
				outline: none;
				border: none;
				cursor: pointer;
				background-color: #b50e0e;
				transition: background-color ease 0.3s;
				margin: auto;
			}

			.toggle[type="checkbox"]:before {
				content: "on off";
				display: block;
				position: absolute;
				z-index: 2;
				width: 28px;
				height: 28px;
				background: #fff;
				left: 2px;
				top: 2px;
				border-radius: 50%;
				font: 10px/28px Helvetica;
				text-transform: uppercase;
				font-weight: bold;
				text-indent: -22px;
				word-spacing: 37px;
				color: #fff;
				text-shadow: -1px -1px rgba(0,0,0,0.15);
				white-space: nowrap;
				box-shadow: 0 1px 2px rgba(0,0,0,0.2);
				transition: all cubic-bezier(0.3, 1.5, 0.7, 1) 0.3s;
				clip-path: none;
				transform: none;
			}

			.toggle[type="checkbox"]:checked {
				background-color: #4CD964;
			}

			.toggle[type="checkbox"]:checked:before {
				left: 32px;
			}
			
			.toggle[type="checkbox"]:focus {
				outline: none;
				outline-offset: none;
			}
			
			.helpList {
				list-style: none;
				padding-left: 20px;
			}

			.helpList li::before {
				content: ".";
				display: inline-block;
				width: 1em;
				margin-left: -1em;
				border-radius: 100%;
				border: 1px solid rgb(102 51 153);
				font-size: 5px;
				vertical-align: middle;
				box-shadow: inset 0px 0px 0px 1px rgba(102, 51, 153, 0.5);
			}
			
			#tilesetTileId {
				background: white;
				visibility: hidden;
				opacity: 0;
				width: 100px;
				height: 25px;
				position: absolute;
				top: 0px;
				left: 0px;
				z-index: 1000;
				border: solid 2px black;
				border-radius: 5px;
				font-size: 18px;
				padding: 10px;
				transition: visibility 0s, opacity 0.2s linear;
			}
			
			#spriteBorders {
				background: rgba(0, 0, 0, 0.2);
				visibility: hidden;
				opacity: 0;
				width: 46px;
				height: 46px;
				position: absolute;
				top: 0px;
				left: 0px;
				z-index: 1000;
				border: solid 2px black;
				transition: visibility 0s, opacity 0.2s linear;
			}
			
			.relative {
				position: relative;
			}
			
			.block {
				display: block !important;
			}
			
			.flex {
				display: flex;
			}
			
			.floatLeft {
				float: left;
			}
			
			.padding0 {
				padding: 0px;
			}
			
			.padding5 {
				padding: 5px;
			}
			
			.padding20 {
				padding: 20px !important;
			}
			
			.paddingB5 {
				padding-bottom: 5px;
			}
			
			.paddingB15 {
				padding-bottom: 15px;
			}
			
			.marginL5 {
				margin-left: 5px;
			}
			
			.marginLN25 {
				margin-left: -25px;
			}
			
			.marginR5 {
				margin-right: 5px;
			}
			
			.marginRN25 {
				margin-right: -25px;
			}
			
			.marginB5 {
				margin-bottom: 5px;
			}
			
			.marginB05EM {
				margin-bottom: 0.5em;
			}
			
			.gridTemColMin2 {
				grid-template-columns: min-content 2fr;
			}
			
			.gridTemRowMinMax {
				grid-template-rows: min-content max-content;
			}
			
			.gridTemCol2Min {
				grid-template-columns: 2fr min-content;
			}
			
			.gridTemCol2Max {
				grid-template-columns: 2fr max-content;
			}
			
			.gridTemColMinAuto {
				grid-template-columns: min-content auto;
			}
			
			.gridTemRowMaxMin {
				grid-template-rows: max-content min-content;
			}
			
			.gridColGap {
				grid-column-gap: 0.5em;
			}
			
			.gridRowGap5 {
				grid-row-gap: 5px;
			}
			
			.alignSelfCenter {
				align-self: center;
			}
			
			.alignItemsCenter {
				align-items: center;
			}
			
			.bgGreen {
				background-color : rgba(0, 154, 15, 0.7)
			}
			
			.bgRed {
				background-color : rgba(159, 0, 0, 0.7)
			}
			
			.bgWhite {
				background: white;
			}
			
			.bgRoot {
				background: var(--background-color);
			}
			
			.linearBackgroundGreen {
				background: linear-gradient(90deg, rgba(2,0,36,0) 0%, forestgreen 30%, forestgreen 70%, rgba(0,0,0,0) 100%);
			}
			
			.linearBackgroundRed {
			    background: linear-gradient(90deg, rgba(2,0,36,0) 0%, #b50e0e 30%, #b50e0e 70%, rgba(0,0,0,0) 100%);	
			}
			
			.marginAuto {
				margin: auto;
			}
			
			.textCenter {
				text-align: center;
			}
			
			.textRight {
				text-align: right;
			}
			
			.textLeft {
				text-align: left;
			}
			
			.red {
				color: red;
			}
			
			.green {
				color: green;
			}
			
			.colorRoot {
				color: var(--color);
			}
			
			.bold {
				font-weight: bold;
			}
			
			.margin0 {
				margin: 0;
			}
			
			.mBottom025 {
				margin-bottom: 0.5em;
			}
			
			.mBottom05 {
				margin-bottom: 0.5em;
			}
			
			.mBottom1 {
				margin-bottom: 1em;
			}
			
			.mBottom2 {
				margin-bottom: 2em;
			}
			
			.mTop1 {
				margin-top: 1em;
			}
			
			.margin05 {
				margin: 0.5em:
			}
			
			.mRight1 {
				margin-right: 1em;
			}
			
			.pointer {
				cursor: pointer;
			}
			
			.rowGap1 {
				grid-row-gap: 1em;
			}
			
			.fRight {
				float: right;
			}
			
			.w25 {
				width: 2.5em;
			}
			
			.w15 {
				width: 1.5em;
			}
			
			.w30P {
				width: 30%;
			}
			
			.w50P {
				width: 50%;
			}
			
			.hAuto {
				height: auto;
			}
			
			.fSize20 {
				font-size: 20px;
			}
			
			.fSize12 {
				font-size: 12px;
			}
			
			.transitionAll025 {
				transition: all 0.25s linear;
			}
			
			.noscroll { 
				position: fixed !important;
				top: 0px;
				bottom: 0px;
				left: 0px;
				right: 0px;
				overflow-y: scroll !important;
			}
			
			.borderForestGreen2 {
				border: 2px solid forestgreen !important;
			}
			
			.borderIndianRed2 {
				border: 2px solid indianred !important;
			}
			
			.disabled {
				border: 2px solid #828282 !important;
			}
			
			.borderColorRoot {
				border-color: var(--color);
			}
			
			.fontSystemUi {
				font-family: system-ui;
			}
			
			.fontSansSerif {
				font-family: sans-serif;
			}
			
			.overflowOverlay {
				overflow: overlay;
			}
			
			.clearfix {
				display: block;
				clear: both;
			}
			
			.whiteSpacePreWrap {
				white-space: pre-wrap;
			}
			
			
			#form-slider {
				margin: 0;
				margin-bottom: 20px;
				margin-top: 10px;
			}
			
			#slider-title {
				margin-top: 0;
				font-weight: bold;
				text-align: center;
				font-size: 18px;
				margin-left: 10px;
			}
			
			#slider {
				display: flex;
				flex-direction: row;
				align-content: stretch;
				position: relative;
				width: 100%;
				height: 25px;
				user-select: none;
			}
			
			#slider::before {
				content: " ";
				position: absolute;
				height: 2px;
				width: 100%;
				width: calc(100% * (2 / 3));
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				background: rebeccapurple;
			}
			
			#slider input, #slider label {
				box-sizing: border-box;
				flex: 1;
				user-select: none;
				cursor: pointer;
			}
			
			#slider label {
				display: inline-block;
				position: relative;
				width: 20%;
				height: 100%;
				user-select: none;
			}
			
			#slider label::before {
				content: attr(data-slider-option);
				position: absolute;
				left: 50%;
				padding-top: 10px;
				transform: translate(-50%, 15px) scale(0.9);
				font-size: 14px;
				letter-spacing: 0.4px;
				font-weight: 400;
				white-space: nowrap;
				opacity: 0.85;
				transition: all 0.15s ease-in-out;
			}
			
			#slider label::after {
				content: " ";
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%) scale(0.75);
				width: 20px;
				height: 20px;
				border: 2px solid #000;
				background: #fff;
				border-radius: 50%;
				pointer-events: none;
				user-select: none;
				z-index: 1;
				cursor: pointer;
				transition: all 0.15s ease-in-out;
			}
			
			#slider label:hover::after {
				transform: translate(-50%, -50%) scale(1.25);
			}
			
			#slider input {
				display: none;
			}
			
			#slider input:checked + label::before {
				font-weight: 800;
				opacity: 1;
				transform: translate(-50%, 20px) scale(1.1);
			}
			
			#slider input:checked + label::after {
				border-width: 4px;
				transform: translate(-50%, -50%) scale(1);
			}
	
			#slider input:checked ~ #slider-pos {
				opacity: 1;
			}
			
			#slider-pos {
				display: block;
				position: absolute;
				top: 50%;
				left: 50%;
				width: 12px;
				height: 12px;
				background: rebeccapurple;
				border-radius: 50%;
				transition: all 0.15s ease-in-out;
				transform: translate(-50%, -50%);
				border: 2px solid white;
				opacity: 0;
				z-index: 2;
			}
			
			#buttonGrid[data-grid="false"]:after {
				content: "Show Grid";
				width: min-content;
				height: min-content;
			}
			
			#buttonGrid[data-grid="true"]:after {
				content: "Hide Grid";
				width: min-content;
				height: min-content;
			}
			
			#buttonCollisions[data-collisions="false"]:after, #buttonMinimapCollision[data-collisions="false"]:after {
				content: "Show Collisions";
				width: min-content;
				height: min-content;
			}
			
			#buttonCollisions[data-collisions="true"]:after, #buttonMinimapCollision[data-collisions="true"]:after {
				content: "Hide Collisions";
				width: min-content;
				height: min-content
			}
			
			#buttonRegionsId[data-regionsId="false"]:after, #buttonMinimapRegionsId[data-regionsId="false"]:after {
				content: "Show Regions ID";
				width: min-content;
				height: min-content;
			}
			
			#buttonRegionsId[data-regionsId="true"]:after, #buttonMinimapRegionsId[data-regionsId="true"]:after {
				content: "Hide Regions ID";
				width: min-content;
				height: min-content
			}  
			
			#minimap {
				--minimap-tile-size: 20px;
				position: relative;
				margin: auto;
				margin-top: 20px;
				overflow-x: auto;
				width: min(calc(var(--map-width) * var(--minimap-tile-size)), 100%); 
				height: calc(var(--map-height) * var(--minimap-tile-size));
			}
			
			.minimapTile {
				background-color: var(--color);
				position: absolute;
				box-sizing: border-box;
				border: 1px solid var(--background-color);
				color: var(--background-color);
				font-weight: bold;
				font-size: 14px;
				padding-top: 2px;
				text-align: center;
				cursor: pointer;
				width: var(--minimap-tile-size);
				height: var(--minimap-tile-size);
				left: calc(var(--x) * var(--minimap-tile-size));
				top: calc(var(--y) * var(--minimap-tile-size));
			}
			
			.minimapTile[data-hasEvent]:not([data-hasEvent="0"])::after {
				content: 'Ev';
			}
			
			.minimapTile[data-hasPlayer]:not([data-hasPlayer="false"])::after {
				content: 'P';
			}
			
			.minimapTile:hover {
				border: 2px solid var(--background-color);
			}
			
			.minimapTile[data-selected="true"] {
				background-color: var(--background-color);
				border: 1px solid var(--color);
				color: var(--color);
			}
			
			#minimap.collisionEnabled .minimapTile {
				border-color: red;
			}
			
			#minimap.collisionEnabled .minimapTile[data-bPassable="true"], .tileData[data-bPassable="true"] {
				border-bottom-color: forestgreen;
				border-bottom-style: dashed;
			}
			
			#minimap.collisionEnabled .minimapTile[data-lPassable="true"], .tileData[data-lPassable="true"] {
				border-left-color: forestgreen;
				border-left-style: dashed;
			}
			
			#minimap.collisionEnabled .minimapTile[data-rPassable="true"], .tileData[data-rPassable="true"] {
				border-right-color: forestgreen;
				border-right-style: dashed;
			}
			
			#minimap.collisionEnabled .minimapTile[data-tPassable="true"], .tileData[data-tPassable="true"] {
				border-top-color: forestgreen;
				border-top-style: dashed;
			}
			
			#minimap.regionIdEnabled .minimapTile {
				background-color: var(--regionId-background-color);
			}
			
			#minimap.regionIdEnabled .minimapTile::after {
				content: attr(data-regionId);
			}
			
			#tileSelectedData #tilePos::after {
				content: "Position : [x: " attr(data-x) ", y: " attr(data-y) "]";
			}
			
			#tileSelectedData #tileEventsId::after {
				content: "Events Id :" attr(data-hasEvent);
			}
			
			.tileData {
				margin: auto;
				width: 40%;
				position: relative;
				border: 5px solid red;
				box-sizing: border-box;
			}
			
			.tileData:before {
				content: "Region ID " attr(data-regionId);
				width: min-content;
				min-width: 110px;
				font-weight: bold;
				font-size: 23px;
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
				text-align: center;
				font-family: sans-serif;
			}
			
			.tileData:after {
				content: "";
				display: block;
				padding-bottom: 100%;
			}
			
			#minimapData {
				visibility: hidden;
				opacity: 0;
				width: auto;
				padding: 5px 10px;
				z-index: 1;
				background: var(--background-color);
				border: 1px solid var(--color);
				color: var(--color);
				position: absolute;
				text-align: center;
				font-weight: bold;
				font-size: 16px;
				box-shadow: 0px 6px 20px 0px rgb(0 0 0 / 60%);
			}		
			
			#commandContainer div:nth-child(even) {
				background-color: var(--color-alpha-03);
			}
			
			.eCommand {
				font-size: 18px;
				position: relative;
				box-sizing: border-box;
			}
			
			.eCommand > div {
				min-height: 34px;
				line-height: 34px;
				padding-left: 5px;
			}
			
			.eCommand > div > .hasEventCommandData {
				min-height: 34px;
				line-height: 34px;
				border: 1px solid transparent;
				padding-right: 1em;
			}
			
			.eCommand > div > .hasEventCommandData:hover {
				border: 1px solid var(--color);
				cursor: pointer;
			}
			
			.hasEventCommandData:after {
				content: "+";
				font-weight: bold;
				position: absolute;
				top: 50%;
				right: 5px;
				transform: translate(0px, -50%);
			}
			
			.eBranch {
				margin-left: 0.5em;
				padding-left: 0.5em;
				border-left: 5px solid var(--color);
				box-sizing: border-box;
			}
			
			.eventCommandData {
				line-height: normal;
			}
			
			#commandContainer .eCommand .eventCommandData div:nth-child(even) {
				background-color: var(--background-color);
			}
			
			.textareaCommandData {
				height: 140px;
				display: block;
				max-width: 100%;
				width: 100%;
				resize: none;
				border: 1px solid var(--color);
			}
		</style>
    </head>
    <body>
		<div id="tilesetTileId"></div>
		<div id="spriteBorders"></div>
		<div id="menu" class="menuClosed fixed">
			<div class="openMenu"><span>&#9776;</span></div>
			<div class="submenus">
				<div data-label="Switches" class="submenu subMenuSelected" onclick="onMenuClick(this)"><span>Switches</span></div>
				<div data-label="Variables" class="submenu" onclick="onMenuClick(this)"><span>Variables</span></div>
				<div data-label="Self Switches" class="submenu" onclick="onMenuClick(this)"><span>Self Switches</span></div>
				<div data-label="Events" class="submenu" onclick="onMenuClick(this)"><span>Events</span></div>
				<div data-label="Map" class="submenu" onclick="onMenuClick(this)"><span>Map</span></div>
				<div data-label="Interpreter" class="submenu" onclick="onMenuClick(this)"><span>Interpreter</span></div>
				<div data-label="Player" class="submenu" onclick="onMenuClick(this)"><span>Player</span></div>
			</div>
		</div>
		<div onclick="toggleLightMode()" id="lightMode">
			<span>&#9790;</span>
			<span>&#9728;</span>
		</div>
		<script type="text/javascript">		
			
			//----------------------------------------------------------------------
			//menu
			// window.addEventListener('scroll', function(e) {
				// if (window.scrollY > 0) {
					// document.querySelector('#menu').classList.add("fixed");
				// } else {
					// document.querySelector('#menu').classList.remove("fixed");
				// }
			// });
			
			function onMenuClick(elem, label) {
				if (elem?.classList?.contains("subMenuSelected"))
					return;
				[...document.querySelectorAll('.subMenuSelected')].map(e => e.classList.remove('subMenuSelected'));
				if (elem)
					elem.classList.add("subMenuSelected");
				else 
					document.querySelector(`.submenu[data-label="${label}"]`).classList.add("subMenuSelected")
				
				label ??= elem?.getAttribute('data-label');
				if (elem)
					onViewMenuChange(null, label)
			}
		
			//----------------------------------------------------------------------
			//init functions
		
			function main() {
				document.title = window.opener.Drag.Debugger.nwWindowName;
				proxy = null;
				createView();
				loadDataMainWindow();
				setLightMode();
				loadPIXI();
				createMenu();
				refreshView();
			};
			
			function createView() {
				view = document.createElement('div');
				view.setAttribute('id', 'view');
				document.body.appendChild(view)
			};
			
			function setLightMode(lightMode = null) {
				lightMode ??= Drag.Debugger.params.lightMode || "light";
				let eDarkMode = document.querySelector("#lightMode");
				if (lightMode === "light") {
					document.documentElement.style.setProperty('--background-color', '#ffffff');
					document.documentElement.style.setProperty('--color', "#000000");
					document.documentElement.style.setProperty('--color-alpha-03', '#0000001a');
					eDarkMode.setAttribute('data-lightMode', lightMode);
				} else if (lightMode === "dark") {
					document.documentElement.style.setProperty('--background-color', '#2a2b36');
					document.documentElement.style.setProperty('--color', '#f5f5dc');
					document.documentElement.style.setProperty('--color-alpha-03', '#f5f5dc0d');
					eDarkMode.setAttribute('data-lightMode', lightMode);
				}
			};
			
			function toggleLightMode() {
				let lightMode = document.querySelector("#lightMode").getAttribute('data-lightMode');
				if (lightMode === "light")
					setLightMode("dark");
				else if (lightMode === "dark")
					setLightMode("light");
			};
			
			function loadDataMainWindow() {
				mainWindow = window.opener;
				$dataSystem = mainWindow.$dataSystem;
				$dataMapInfos = mainWindow.$dataMapInfos;
				$dataMap = mainWindow.$dataMap;
				$dataItems = mainWindow.$dataItems;
				$dataActors = mainWindow.$dataActors;
				$dataCommonEvents = mainWindow.$dataCommonEvents;
				$gameParty = mainWindow.$gameParty;
				$gameActors = mainWindow.$gameActors;
				$gameMap = mainWindow.$gameMap;
				$gameSwitches = mainWindow.$gameSwitches;
				$gameVariables = mainWindow.$gameVariables;
				$gameSelfSwitches = mainWindow.$gameSelfSwitches;
				$gamePlayer = mainWindow.$gamePlayer;
				Drag = mainWindow.Drag;
			};
			
			function loadPIXI() {
				const script = document.createElement("script"); 
				script.type = "text/javascript"; 
				script.src =  "js/libs/pixi.js"; 
				script.async = false;  
				script.defer = true;  
				//script.onload = initApp;
				script._url = "js/libs/pixi.js";  
				document.body.appendChild(script);  
			};
			
			function initApp() {
				app = new PIXI.Application({
					width: 384,
					height: 1536,
					backgroundColor: 0xffffff
				});
				document.body.appendChild(app.view);
				app.view.style.border = "2px black solid";
			};
			
			//----------------------------------------------------------------------
			//nw menu
			
			function createMenu() {
				//main menu bar
				let menu = new nw.Menu({ type: 'menubar' });
				
				//exit option
				let exitSubMenu = new nw.Menu();
				exitSubMenu.append(new nw.MenuItem({
					label: 'Exit',
					click: function(){
						nw.Window.get().close();
					}
				}));
				
				menu.append(new nw.MenuItem({
					label: 'Exit',
					submenu: exitSubMenu
				}));
				
				//view option
				let viewSubMenu = new nw.Menu();
				
				//switches sub option
				viewSubMenu.append(new nw.MenuItem({
					label: 'Switches',
					type: 'checkbox',
					checked: true,
					click: function(){
						if (this.checked === true)
							onViewMenuChange(this);
						else
							this.checked = true;
					}
				}));
				
				viewSubMenu.append(new nw.MenuItem({
					label: 'Variables',
					type: 'checkbox',
					checked: false,
					click: function(){
						if (this.checked === true)
							onViewMenuChange(this);
						else
							this.checked = true;
					}
				}));
				
				viewSubMenu.append(new nw.MenuItem({
					label: 'Self Switches',
					type: 'checkbox',
					checked: false,
					click: function(){
						if (this.checked === true)
							onViewMenuChange(this);
						else
							this.checked = true;
					}
				}));
				
				viewSubMenu.append(new nw.MenuItem({
					label: 'Events',
					type: 'checkbox',
					checked: false,
					click: function(){
						if (this.checked === true)
							onViewMenuChange(this);
						else
							this.checked = true;
					}
				}));
				
				viewSubMenu.append(new nw.MenuItem({
					label: 'Map',
					type: 'checkbox',
					checked: false,
					click: function(){
						if (this.checked === true)
							onViewMenuChange(this);
						else
							this.checked = true;
					}
				}));
				
				viewSubMenu.append(new nw.MenuItem({
					label: 'Interpreter',
					type: 'checkbox',
					checked: false,
					click: function(){
						if (this.checked === true)
							onViewMenuChange(this);
						else
							this.checked = true;
					}
				}));
				
				viewSubMenu.append(new nw.MenuItem({
					label: 'Player',
					type: 'checkbox',
					checked: false,
					click: function(){
						if (this.checked === true)
							onViewMenuChange(this);
						else
							this.checked = true;
					}
				}));
				
				//tileset sub option //deactivated for now
				// let tilesetSubMenu = new nw.Menu();
				// viewSubMenu.append(new nw.MenuItem({
					// label: 'Tileset',
					// submenu: tilesetSubMenu
				// }));
				
				// tilesetSubMenu.append(new nw.MenuItem({
					// label: 'A',
					// type: 'checkbox',
					// checked: true,
					// click: function(){
						// if (this.checked === true)
							// onTilesetMenuChange(this);
					// }
				// }));
				// tilesetSubMenu.append(new nw.MenuItem({
					// label: 'B',
					// type: 'checkbox',
					// checked: false,
					// click: function(){
						// if (this.checked === true)
							// onTilesetMenuChange(this);
					// }
				// }));
				// tilesetSubMenu.append(new nw.MenuItem({
					// label: 'C',
					// type: 'checkbox',
					// checked: false,
					// click: function(){
						// if (this.checked === true)
							// onTilesetMenuChange(this);
					// }
				// }));
				// tilesetSubMenu.append(new nw.MenuItem({
					// label: 'D',
					// type: 'checkbox',
					// checked: false,
					// click: function(){
						// if (this.checked === true)
							// onTilesetMenuChange(this);
					// }
				// }));
				// tilesetSubMenu.append(new nw.MenuItem({
					// label: 'E',
					// type: 'checkbox',
					// checked: false,
					// click: function(){
						// if (this.checked === true)
							// onTilesetMenuChange(this);
					// }
				// }))
				
				menu.append(new nw.MenuItem({
					label: 'View',
					submenu: viewSubMenu
				}));
				
				//layer option //deactivated for now.
				// let layerSubMenu = new nw.Menu();
				
				// layerSubMenu.append(new nw.MenuItem({
					// label: 'Show Layer 1',
					// type: 'checkbox',
					// checked: true,
					// click: function(){
						// onLayersMenuChange(this, 0);
					// }
				// }));
				// layerSubMenu.append(new nw.MenuItem({
					// label: 'Show Layer 2',
					// type: 'checkbox',
					// checked: true,
					// click: function(){
						// onLayersMenuChange(this, 1);
					// }
				// }));
				// layerSubMenu.append(new nw.MenuItem({
					// label: 'Show Layer 3',
					// type: 'checkbox',
					// checked: true,
					// click: function(){
						// onLayersMenuChange(this, 2);
					// }
				// }));
				// layerSubMenu.append(new nw.MenuItem({
					// label: 'Show Layer 4',
					// type: 'checkbox',
					// checked: true,
					// click: function(){
						// onLayersMenuChange(this, 3);
					// }
				// }));
				
				// menu.append(new nw.MenuItem({
					// label: 'Layers',
					// submenu: layerSubMenu
				// }));
				
				//add menu to window
				nw.Window.get().menu = menu;
			};
			
			function onViewMenuChange(submenu, label) {
				updateViewSubmenu(submenu, label);
				refreshView();
			};
			
			function onLayersMenuChange(submenu, layer) {
				let submenuChecked = submenu.checked;
				updateLayers(layer, submenuChecked);
			};
			
			function onTilesetMenuChange(submenu) {
				updateTilesetSubmenu(submenu);
				clearTileset();
				showTileset(submenu.label);
			};
			
			function updateViewSubmenu(submenu, label) {
				if (!submenu)
					submenu = nw.Window.get().menu.items.find(obj => obj.label === "View").submenu.items.find(obj => obj.label === label);
				else
					onMenuClick(null, submenu.label)
				let viewSubMenu = nw.Window.get().menu.items.find(obj => obj.label === "View").submenu.items;
				for (item of viewSubMenu) {
					if (item.label !== submenu.label && item.label !== "Tileset")
						item.checked = false;
					else 
						item.checked = true;
				}
			};
			
			function updateTilesetSubmenu(submenu = {}) {
				let submenuLabel = submenu.label;
				let tilesetSubmenu = nw.Window.get().menu.items.filter(obj => obj.label === "Tileset").submenu.items;
				for (item of tilesetSubmenu) {
					if (item.label !== submenu.label)
						item.checked = false;
				}
			};
			
			//----------------------------------------------------------------------
			//display/refresh view
			
			function requestRefreshView() {
				if (!window.opener.document.hasFocus())
					return;
				refreshView();
			};
			
			function refreshView() {
				refreshData();
				let viewMenu = nw.Window.get().menu.items.find(obj => obj.label === "View");
				let viewOption = viewMenu.submenu.items.find(obj => obj.checked === true);
				switch (viewOption.label) {
					case 'Switches':
						displaySwitches();
						break;
					case 'Variables':
						displayVariables();
						break;
					case 'Self Switches':
						displaySelfSwitches();
						break;
					case 'Events':
						displayEvents();
						break;
					case 'Map':
						displayMap();
						break;
					case 'Interpreter':
						displayInterpreter();
						break;
					case 'Player':
						displayPlayer();
						break;
					case 'Tileset':
						break;
					default:
				}
			};
			
			function refreshData() {
				$dataSystem = mainWindow.$dataSystem;
				$dataMapInfos = mainWindow.$dataMapInfos;
				$dataMap = mainWindow.$dataMap;
				$dataItems = mainWindow.$dataItems;
				$dataActors = mainWindow.$dataActors;
				$$dataCommonEvents = mainWindow.$dataCommonEvents;
				$gameParty = mainWindow.$gameParty;
				$gameActors = mainWindow.$gameActors;
				$gameMap = mainWindow.$gameMap;
				$gameSwitches = mainWindow.$gameSwitches;
				$gameVariables = mainWindow.$gameVariables;
				$gameSelfSwitches = mainWindow.$gameSelfSwitches;
				$gamePlayer = mainWindow.$gamePlayer;
				Drag = mainWindow.Drag;
			};
			
			function displaySwitches() {
				let dataView = view.getAttribute('data-view')
				if (dataView !== "switches")
					initSwitches();
				else
					updateSwitches();
			};
			
			function displayVariables() {
				let dataView = view.getAttribute('data-view')
				if (dataView !== "variables")
					initVariables();
				else
					updateVariables();
			};
			
			function displaySelfSwitches() {
				let dataView = view.getAttribute('data-view')
				if (dataView !== "self-switches")
					initSelfSwitches();
				else
					updateSelfSwitches();
			};
			
			function displayEvents() {
				let dataView = view.getAttribute('data-view')
				if (dataView !== "events")
					initEvents();
				else
					updateEvents();
			};
			
			function displayMap() {
				let dataView = view.getAttribute('data-view')
				if (dataView !== "map")
					initMap();
				else
					updateMap();
			};
			
			function displayInterpreter() {
				let dataView = view.getAttribute('data-view')
				if (dataView !== "interpreter")
					initInterpreter();
				else
					updateInterpreter();
			};
			
			function displayPlayer() {
				let dataView = view.getAttribute('data-view')
				if (dataView !== "player")
					initPlayer();
				else
					updatePlayer();
			};
			
			//----------------------------------------------------------------------
			//headers
			
			function updateSliderPos(elem) {
				let eSliderPos = elem.parentNode.querySelector('#slider-pos');
				let left = (parseInt(elem.value) * 33.33333) - 16.66665;
				eSliderPos.style.left = left + "%";
			};
			
			function getViewHeader(type) {
				switch (type) {
					case 'switches':
						return `
							<h1>Game Switches <span onmouseenter="showTooltip()" onmouseleave="hideTooltip()" class="showInfoTooltip">&#x2139;</span></h1>
							<div class="info invisible">
								<p><span style="color: steelblue; font-size: 18px; font-weight: bold">Game Switches</span> are <b>boolean value (on:true</b> or <b>off:false)</b> that can be toggled at any time using the <i>Control Switches</i> event command.</p>
								<p>You can also use a <i>script call</i> to access them :</p>
								<p>- <b>$gameSwitches.value(switchID)</b> to get the value of a specific switch, where <i>switchID is the switch ID in your switch list</i>.</p>
								<p> <i>e.g.</i> <b>$gameSwitches.value(2)</b>
								<p>- <b>$gameSwitches.set(switchID, value)</b> to set a specific switch to on or off, where <i>switchID is the switch ID in your switch list</i> and <i>value is either true or false</i>.</p>
								<p> <i>e.g.</i> <b>$gameSwitches.set(2, true)</b>
							</div>
							<br>
							<form id="form-slider">
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<div>
									<span id="slider-title">Show Named / Nameless</span>
									<div id="slider">
										<input onclick="updateSliderPos(this); updateSwitches();" type="radio" name="slider-option" id="showNamelessSwitches" value="1" required>
										<label for="showNamelessSwitches" data-slider-option="Nameless"></label>
										<input onclick="updateSliderPos(this); updateSwitches();" type="radio" name="slider-option" id="noFilterNamed" value="2" required checked>
										<label for="noFilterNamed" data-slider-option="No Filter"></label>
										<input onclick="updateSliderPos(this); updateSwitches();" type="radio" name="slider-option" id="showNamedSwitches" value="3" required>
										<label for="showNamedSwitches" data-slider-option="Named"></label>
										<div id="slider-pos"></div>
									</div>
								</div>
							</form>
							<form id="form-slider">
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<div>
									<span id="slider-title">Show ON / OFF</span>
									<div id="slider">
										<input onclick="updateSliderPos(this); updateSwitches();" type="radio" name="slider-option" id="showONOnly" value="1" required>
										<label for="showONOnly" data-slider-option="ON"></label>
										<input onclick="updateSliderPos(this); updateSwitches();" type="radio" name="slider-option" id="noFilterState" value="2" required checked>
										<label for="noFilterState" data-slider-option="No Filter"></label>
										<input onclick="updateSliderPos(this); updateSwitches();" type="radio" name="slider-option" id="showOFFOnly" value="3" required>
										<label for="showOFFOnly" data-slider-option="OFF"></label>
										<div id="slider-pos"></div>
									</div>
								</div>
							</form>
							<form>
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<label class="form-control-filter">
									<span>Filter</span>
									<input onchange="updateSwitches()" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" type="text" placeholder="Enter ID or name" id="filterSwitches" name="filterSwitches">
								</label>
							</form>`;
						break;
					case 'variables':
						return `
							<h1>Game Variables <span onmouseenter="showTooltip()" onmouseleave="hideTooltip()" class="showInfoTooltip">&#x2139;</span></h1>
							<div class="info invisible">
								<p><span style="color: steelblue; font-size: 18px; font-weight: bold">Game Variables</span> are <b>numbers value</b> that can be changed at any time using the <i>Control Variables</i> event command.</p>
								<p>You can also use a <i>script call</i> to access them :</p>
								<p>- <b>$gameVariables.value(varID)</b> to get the value of a specific variable, where <i>varID is the variable ID in your variable list</i>.</p>
								<p> <i>e.g.</i> <b>$gameVariables.value(2)</b>
								<p>- <b>$gameVariables.set(varID, value)</b> to set a specific variable, where <i>varID is the variable ID in your variable list</i> and <i>value is a number</i>.</p>
								<p> <i>e.g.</i> <b>$gameSwitches.set(2, 42)</b>
							</div>
							<br>
							<form>
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<label class="form-control">
									<input onchange="updateVariables()" type="checkbox" id="showNamelessVariables" name="showNamelessVariables" checked>
									Nameless Variables
								</label>
								<label class="form-control">
									<input onchange="updateVariables()" type="checkbox" id="showEmptyVariables" name="showEmptyVariables" checked>
									Value Is 0
								</label>
							</form>
							<form>
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<label class="form-control-filter">
									<span>Filter</span>
									<input onchange="updateVariables()" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" type="text" placeholder="Enter ID or name" id="filterVariables" name="filterVariables">
								</label>
							</form>`;
						break;
					case 'self-switches':
						return `
							<h1>Self Switches <span onmouseenter="showTooltip()" onmouseleave="hideTooltip()" class="showInfoTooltip">&#x2139;</span></h1>
							<div class="info invisible">
								<p><span style="color: steelblue; font-size: 18px; font-weight: bold">Self Switches</span> are <b>boolean value (on:true</b> or <b>off:false)</b> that can be toggled at any time using the <i>Control Self Switches</i> event command.</p>
								<p>Contrary to <span style="color: steelblue; font-size: 18px; font-weight: bold">Game Switches</span>, <span style="color: steelblue; font-size: 18px; font-weight: bold">Self Switches</span> are linked to their respective events.
								<p>You can manipulate up to four self switch by event and are defined by a letter (A, B, C, D).
								<p>You can also use a <i>script call</i> to access them :</p>
								<p>- <b>$gameSelfSwitches.value("mId,evId,sLetter")</b> to get the value of a specific self switch, where <i>mId is the map ID the event belong to</i>, <i>evId is the event ID your switch belong to</i>, <i>sLetter is the self switch letter</i>.</p>
								<p> <i>e.g.</i> <b>$gameSelfSwitches.value("1,1,A")</b>
								<p>- <b>$gameSelfSwitches.set("mId,evId,sLetter", value)</b> to set a specific self switch to on or off, where <i>value is either true or false</i>.</p>
								<p> <i>e.g.</i> <b>$gameSelfSwitches.set("1,1,A", true)</b>
							</div>
							<br>
							<form id="form-slider">
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<div>
									<span id="slider-title">Show ON / OFF</span>
									<div id="slider">
										<input onclick="updateSliderPos(this); updateSelfSwitches();" type="radio" name="slider-option" id="showONOnly" value="1" required>
										<label for="showONOnly" data-slider-option="Has Switch ON"></label>
										<input onclick="updateSliderPos(this); updateSelfSwitches();" type="radio" name="slider-option" id="noFilterState" value="2" required checked>
										<label for="noFilterState" data-slider-option="No Filter"></label>
										<input onclick="updateSliderPos(this); updateSelfSwitches();" type="radio" name="slider-option" id="showOFFOnly" value="3" required>
										<label for="showOFFOnly" data-slider-option="Has Switch OFF"></label>
										<div id="slider-pos"></div>
									</div>
								</div>
							</form>
							<form>
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<label class="form-control-filter">
									<span>Filter</span>
									<input onchange="updateSelfSwitches()" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" type="text" placeholder="Enter event ID or name" id="filterSelfSwitches" name="filterSelfSwitches">
								</label>
							</form>`;
						break;
					case 'events':
						return `
							<h1>
								Events 
								
							</h1>
							<div class="info invisible">
								<p><span style="color: steelblue; font-size: 18px; font-weight: bold">Game Events</span> are objects in your game </p>
								<p>You can also use a <i>script call</i> to access them :</p>
								<p>- <b>$gameSwitches.value(switchID)</b> to get the value of a specific switch, where <i>switchID is the switch ID in your switch list</i>.</p>
								<p> <i>e.g.</i> <b>$gameSwitches.value(2)</b>
								<p>- <b>$gameSwitches.set(switchID, value)</b> to set a specific switch to on or off, where <i>switchID is the switch ID in your switch list</i> and <i>value is either true or false</i>.</p>
								<p> <i>e.g.</i> <b>$gameSwitches.set(2, true)</b>
							</div>
							<br>
							<form id="form-slider">
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<div>
									<span id="slider-title">Filter By State</span>
									<div id="slider">
										<input onclick="updateSliderPos(this); updateEvents();" type="radio" name="slider-option" id="showRunningOnly" value="1" required>
										<label for="showRunningOnly" data-slider-option="Running"></label>
										<input onclick="updateSliderPos(this); updateEvents();" type="radio" name="slider-option" id="noFilterRunning" value="2" required checked>
										<label for="noFilterRunning" data-slider-option="No Filter"></label>
										<input onclick="updateSliderPos(this); updateEvents();" type="radio" name="slider-option" id="showNotRunningOnly" value="3" required>
										<label for="showNotRunningOnly" data-slider-option="Not Running"></label>
										<div id="slider-pos"></div>
									</div>
								</div>
							</form>
							<form id="form-slider">
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<div>
									<span id="slider-title">Filter By Active Pages</span>
									<div id="slider">
										<input onclick="updateSliderPos(this); updateEvents();" type="radio" name="slider-option" id="showActiveOnly" value="1" required>
										<label for="showActiveOnly" data-slider-option="Have Active Pages"></label>
										<input onclick="updateSliderPos(this); updateEvents();" type="radio" name="slider-option" id="noFilterActive" value="2" required checked>
										<label for="noFilterActive" data-slider-option="No Filter"></label>
										<input onclick="updateSliderPos(this); updateEvents();" type="radio" name="slider-option" id="showNoActiveOnly" value="3" required>
										<label for="showNoActiveOnly" data-slider-option="No Active Pages"></label>
										<div id="slider-pos"></div>
									</div>
								</div>
							</form>
							<form>
								<button type="submit" disabled style="display: none" aria-hidden="true"></button>
								<label class="form-control-filter">
									<span>Filter</span>
									<input onchange="updateEvents()" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" type="text" placeholder="Enter event ID or name" id="filterEvents" name="filterEvents">
								</label>
							</form>`;
						break;
					case 'map':
						return `
							<h1>
								Map 
								
							</h1>`;
						break;
					case 'Interpreter':
						return `
							<h1>
								Interpreter 
								
							</h1>`;
						break;
					case 'player':
						return `
							<h1>
								Player 
								
							</h1>`;
						break;
					default:
						return '';
				}
			};
			
			function getMapHeader(mapId = $gameMap._mapId, name = null) {
				if (!name)
					name = $dataMapInfos?.[mapId]?.name || "";
				return `<br><h2>Map <span class="circle">${mapId}</span> <span class="fontSystemUi">${name}</span></h2>`;
			};
			
			function getEventHeader(eventId, eventName) {
				return `
					<div class="textCenter">
						<hr class="divider">
						<h3 class="marginAuto">
							<span class="squareTitle colorRoot borderColorRoot">${eventId}</span>
							<span class="squareTitle colorRoot borderColorRoot">${eventName}</span>
						</h3>
					</div>`;
			};
			
			function getPlayerHeader() {
				return `
					<div class="textCenter">
						<hr class="divider">
						<h3 class="marginAuto">
							<span class="squareTitle colorRoot borderColorRoot">Game Player</span>
						</h3>
					</div>`;
			};
			
			//----------------------------------------------------------------------
			//map view
			
			function initInterpreter() {
				view.setAttribute('data-view', 'interpreter');
				let viewHTML = getViewHeader('interpreter');
				const mapAvailable = isMapAvailable();
				viewHTML += `
					<div data-mapID="${$gameMap.mapId()}" id="content">
						${getMapHeader()}
						<div class="grid2col">
							<div>
								<label>Select an event :</label>
								<div class="selectEvent select">
									<select id="selectEvent" onchange="populateEvent();" ${mapAvailable ? '' : 'disabled'}">
				`;
				for (event of $gameMap.events())
					viewHTML += `
										<option>${event.eventId()}</option>
					`;
				viewHTML += `
									</select>
								</div>
							</div>
						</div>
						<div id="commandList"></div>
					</div>
				`;
				view.innerHTML = viewHTML;
				populateEvent();
			};
			
			function populateEvent() {
				let eventId = parseInt(selectEvent.value) || 0;
				if (isMapAvailable() && eventId !== 0) {
					let commandList = document.querySelector('#commandList');
					commandList.setAttribute('eventId', eventId);
					const gameEvent = $gameMap.event(eventId);
					const dataEvent = gameEvent.event();
					const eventName = dataEvent.name;
					commandList.innerHTML = `${getEventHeader(eventId, eventName)}`;
					populateEventCommands(dataEvent, gameEvent);
				}
			};
			
			function populateEventCommands(dataEvent, gameEvent) {
				let commandList = document.querySelector('#commandList');
				const mapInterpreterIndex = $gameMap._interpreter._index;
				const mapInterpreterEventId = $gameMap._interpreter._eventId;
				const pages = dataEvent.pages;
				for ([i, page] of pages.entries()) {
					commandList.innerHTML += `${getEventElemPageHeader(i, gameEvent)}`;
					const commandContainer = document.createElement('div');
					commandContainer.setAttribute('id', 'commandContainer');
					commandContainer.setAttribute('data-pageId', i);
					commandList.appendChild(commandContainer);
					let list = page.list;
					let branches = [];
					let multiLineCommand = 0;
					for ([j, command] of list.entries()) {
						let eCommand = createCommand();
						
						eCommand.setAttribute('data-commandCode', command.code);
						eCommand.setAttribute('data-commandIndex', j);

						if (command.code === 401 || command.code === 405 || command.code === 655 || command.code === 657)
							eCommand.innerHTML = `<div>${getCommandData(command.code, command.parameters, gameEvent.eventId(), i, j)}</div>`;
						
						if (command.code === 505 || command.code === 655 || command.code === 657)
							multiLineCommand = command.code;
						if (multiLineCommand && multiLineCommand !== command.code) {
							multiLineCommand = 0;
							let eBranch = branches.pop();
							if (branches.length > 0)
								branches[branches.length - 1].appendChild(eBranch);
							else
								commandContainer.appendChild(eBranch);
						}	
						
						if (j < mapInterpreterIndex && mapInterpreterEventId === gameEvent.eventId())
							eCommand.style.color = "green";
						
						if ((command.code === 0 || command.code === 404 || command.code === 401 || command.code === 405) && branches.length > 0) { 
							if (command.code !== 401 && command.code !== 405)
								eCommand.classList.add('eCommandEmpty');
							let eBranch = branches.pop();
							eBranch.appendChild(eCommand);
							if (branches.length > 0)
								branches[branches.length - 1].appendChild(eBranch);
							else
								commandContainer.appendChild(eBranch);
						} else {
							if (eCommand.innerHTML === "") {
								let commandData = `<div>${getCommandData(command.code, command.parameters, gameEvent.eventId(), i, j)}</div>`;
								eCommand.innerHTML = commandData;
							}
							if (branches.length > 0)
								branches[branches.length - 1].appendChild(eCommand);
							else
								commandContainer.appendChild(eCommand);
						}
						
						if (command.code === 101 || command.code === 105 || command.code === 102 || command.code === 402 || command.code === 403
						|| command.code === 111 || command.code === 411 || command.code === 112 || command.code === 205 || command.code === 355 || command.code === 357)
							branches.push(createBranch());
					}
				}
			};
			
			function updateInterpreter() {
				let currentMapId = parseInt(document.querySelector("#content").getAttribute("data-mapID"));
				let mapId = $gameMap.mapId();
				if (currentMapId !== mapId) {
					if ($dataMap?.mapId !== currentMapId && $dataMap?.mapId > 0)
						initEvents(view);
				} else {		
					const mapAvailable = isMapAvailable();
					const mapInterpreterIndex = $gameMap?._interpreter?._index;
					const mapInterpreterEventId = $gameMap?._interpreter?._eventId;
					
					let selectEvent = view.querySelector('#selectEvent');
					selectEvent.disabled = !mapAvailable;
					
					let eventId = parseInt(selectEvent.value) || 0;
					const gameEvent = $gameMap.event(eventId);
					let evPageHeaders = view.querySelectorAll('.evPageHeader');
					for (evPageHeader of evPageHeaders)
						updateEventElemPageHeader(evPageHeader, gameEvent);
					
					let evCommandContainers = view.querySelectorAll('#commandContainer');
					for (commandContainer of evCommandContainers) {
						const pageId = commandContainer.getAttribute('pageId');
						for (eCommand of commandContainer.querySelectorAll('.eCommand')) {
							const commandIndex = parseInt(eCommand.getAttribute('data-commandIndex'));
							if (mapInterpreterEventId === gameEvent.eventId() && commandIndex <= mapInterpreterIndex)
								eCommand.classList.add('green');
							else
								eCommand.classList.remove('green');
						}
					}
				}
			};
			
			function createCommand() {
				let eCommand = document.createElement('div');
				eCommand.classList.add('eCommand');
				return eCommand;
			};
			
			function createBranch() {
				let eBranch = document.createElement('div');
				eBranch.classList.add('eBranch');
				return eBranch;
			};
			
			function showEventCommandData(elem) {
				elem.nextElementSibling.classList.remove("uncollapsed");
				document.documentElement.style.top = (-(document.documentElement.scrollTop) + 'px');
				document.documentElement.classList.add("noscroll");
				// elem.parentNode.nextSibling.style.opacity = 255;
			};
			
			function hideEventCommandData(elem) {
				elem.parentNode.parentNode.classList.add("uncollapsed");
				let scrolltop = (-(parseInt(document.documentElement.style.top)));
				document.documentElement.classList.remove("noscroll");
				window.scrollTo(0, scrolltop);
				populateEvent();
			};
			
			function changeEventCommandParam(input) {
				const eventId = input.getAttribute('data-eventId');
				const pageId = input.getAttribute('data-pageId');
				const commandIndex = input.getAttribute('data-commandIndex');
				const paramIndex = input.getAttribute('data-paramIndex');
				const valType = input.getAttribute('data-valType');
				let val = input.value;
				if (valType === 'int') 
					val = parseInt(val) || parseInt(input.min) || 0;
				if (valType === 'bool') 
					val = input.checked
				if (valType === 'arr')
					$gameMap.event(eventId).event().pages[pageId].list[commandIndex].parameters[paramIndex][parseInt(input.getAttribute('data-arrValIndex'))] = val;
				else
					$gameMap.event(eventId).event().pages[pageId].list[commandIndex].parameters[paramIndex] = val;
			}
			
			function getCommandData(code, params, eventId, pageId, commandIndex) {
				switch (code) {
					//move route
					case 0:
						return 'End';
						break;
					case 1:
						return 'Move Down';
						break;
					case 2:
						return 'Move Left';
						break;
					case 3:
						return 'Move Right';
						break;
					case 4:
						return 'Move Up';
						break;
					case 5:
						return 'Move Lower Left';
						break;
					case 6:
						return 'Move Lower Right';
						break;
					case 7:
						return 'Move Upper Left';
						break;
					case 8:
						return 'Move Upper Right';
						break;
					case 9:
						return 'Move at Random';
						break;
					case 10:
						return 'Move Toward Player';
						break;
					case 11:
						return 'Move Away from Player';
						break;
					case 12:
						return 'Move Forward';
						break;
					case 13:
						return 'Move Backward';
						break;
					case 14:
						return 'Jump';
						break;
					case 15:
						return 'Wait';
						break;
					case 16:
						return 'Turn Down';
						break;
					case 17:
						return 'Turn Left';
						break;
					case 18:
						return 'Turn Right';
						break;
					case 19:
						return 'Turn Up';
						break;
					case 20:
						return 'Turn 90° Right';
						break;
					case 21:
						return 'Turn 90° Left';
						break;
					case 22:
						return 'Turn 180°';
						break;
					case 23:
						return 'Turn 90° Right or Left';
						break;
					case 24:
						return 'Turn at Random';
						break;
					case 25:
						return 'Turn Toward Player';
						break;
					case 26:
						return 'Turn Away from Player';
						break;
					case 27:
						return 'Switch On';
						break;
					case 28:
						return 'Switch Off';
						break;
					case 29:
						return 'Change Speed';
						break;
					case 30:
						return 'Change Frequency';
						break;
					case 31:
						return 'Walking Animation On';
						break;
					case 32:
						return 'Walking Animation Off';
						break;
					case 33:
						return 'Stepping Animation On';
						break;
					case 34:
						return 'Stepping Animation Off';
						break;
					case 35:
						return 'Direction Fix On';
						break;
					case 36:
						return 'Direction Fix Off';
						break;
					case 37:
						return 'Through On';
						break;
					case 38:
						return 'Through Off';
						break;
					case 39:
						return 'Transparent On';
						break;
					case 40:
						return 'Transparent Off';
						break;
					case 41:
						return 'Change Image';
						break;
					case 42:
						return 'Change Opacity';
						break;
					case 43:
						return 'Change Blend Mode';
						break;
					case 44:
						return 'Play SE';
						break;
					case 45:
						return 'Script';
						break;
						
					//event command
					case 101:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Show Text, ${params[4]} :</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Show Text</h3>
									<!--<p>Face File : ${params[0]}</p>
									<p>Face File Index : ${params[1]}</p>-->
									<div>
										<label for="101name">Name :</label>
										<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="4"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											type="text" id="101name" name="101name" placeholder="Enter a name" value="${params[4]}"
										>
									</div>
									<div>
										<label for="101background">Background :</label>
										<div class="select">
											<select data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
												onchange="changeEventCommandParam(this)"
												name="101background" id="101background"
											>
												<option value="0" ${params[2] === 0 ? 'selected' : ''}>Window</option>
												<option value="1" ${params[2] === 1 ? 'selected' : ''}>Dim</option>
												<option value="2" ${params[2] === 2 ? 'selected' : ''}>Transparent</option>
											</select>
										</div>
									</div>
									<div>
										<label for="101windowpos">Window Position :</label>
										<div class="select">
											<select data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="3" data-valType="int"
												onchange="changeEventCommandParam(this)"
												name="101windowpos" id="101windowpos"
											>
												<option value="0" ${params[3] === 0 ? 'selected' : ''}>Top</option>
												<option value="1" ${params[3] === 1 ? 'selected' : ''}>Middle</option>
												<option value="2" ${params[3] === 2 ? 'selected' : ''}>Bottom</option>
											</select>
										</div>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 401:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">${params[0].replace(/(\r\n|\n\r|\r|\n)/g, '<br>')}</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Show Text :</h3>
									<div>
										<label for="401text">Text :</label>
										<textarea data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											class="textareaCommandData" id="401text" name="401text" placeholder="Enter text">${params[0]}</textarea>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`; 
						break;
					case 102:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Show Choices</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Show Choices</h3>
									<div>
										<label for="102choices">Choices :</label>
										<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-arrValIndex="0" data-valType="arr"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											type="text" id="102choices" name="102choices" value="${params[0][0] || ''}"
										>
										<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-arrValIndex="1" data-valType="arr"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											type="text" id="102choices" name="102choices" value="${params[0][1] || ''}"
										>
										<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-arrValIndex="2" data-valType="arr"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											type="text" id="102choices" name="102choices" value="${params[0][2] || ''}"
										>
										<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-arrValIndex="3" data-valType="arr"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											type="text" id="102choices" name="102choices" value="${params[0][3] || ''}"
										>
										<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-arrValIndex="4" data-valType="arr"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											type="text" id="102choices" name="102choices" value="${params[0][4] || ''}"
										>
										<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-arrValIndex="5" data-valType="arr"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											type="text" id="102choices" name="102choices" value="${params[0][5] || ''}"
										>
									</div>
									<div>
										<label for="102background">Background :</label>
										<div class="select">
											<select data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="4" data-valType="int"
												onchange="changeEventCommandParam(this)"
												name="102background" id="102background"
											>
												<option value="0" ${params[4] === 0 ? 'selected' : ''}>Window</option>
												<option value="1" ${params[4] === 1 ? 'selected' : ''}>Dim</option>
												<option value="2" ${params[4] === 2 ? 'selected' : ''}>Transparent</option>
											</select>
										</div>
									</div>
									<div>
										<label for="102windowpos">Window Position :</label>
										<div class="select">
											<select data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="3" data-valType="int"
												onchange="changeEventCommandParam(this)"
												name="102windowpos" id="102windowpos"
											>
												<option value="0" ${params[3] === 0 ? 'selected' : ''}>Top</option>
												<option value="1" ${params[3] === 1 ? 'selected' : ''}>Middle</option>
												<option value="2" ${params[3] === 2 ? 'selected' : ''}>Bottom</option>
											</select>
										</div>
									</div>
									<div>
										<label for="102default">Default :</label>
										<div class="select">
											<select data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
												onchange="changeEventCommandParam(this)"
												name="102default" id="102default"
											>
												<option value="-1" ${params[2] === -1 ? 'selected' : ''}>None</option>
												<option value="0" ${params[2] === 0 ? 'selected' : ''}>Choice #1</option>
												<option value="1" ${params[2] === 1 ? 'selected' : ''}>Choice #2</option>
												<option value="2" ${params[2] === 2 ? 'selected' : ''}>Choice #3</option>
												<option value="3" ${params[2] === 3 ? 'selected' : ''}>Choice #4</option>
												<option value="4" ${params[2] === 4 ? 'selected' : ''}>Choice #5</option>
												<option value="5" ${params[2] === 5 ? 'selected' : ''}>Choice #6</option>
											</select>
										</div>
									</div>
									<div>
										<label for="102cancel">Cancel :</label>
										<div class="select">
											<select data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="1" data-valType="int"
												onchange="changeEventCommandParam(this)"
												name="102cancel" id="102cancel"
											>
												<option value="-2" ${params[2] === -2 ? 'selected' : ''}>Branch</option>
												<option value="-1" ${params[2] === -1 ? 'selected' : ''}>Disallow</option>
												<option value="0" ${params[2] === 0 ? 'selected' : ''}>Choice #1</option>
												<option value="1" ${params[2] === 1 ? 'selected' : ''}>Choice #2</option>
												<option value="2" ${params[2] === 2 ? 'selected' : ''}>Choice #3</option>
												<option value="3" ${params[2] === 3 ? 'selected' : ''}>Choice #4</option>
												<option value="4" ${params[2] === 4 ? 'selected' : ''}>Choice #5</option>
												<option value="5" ${params[2] === 5 ? 'selected' : ''}>Choice #6</option>
											</select>
										</div>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 402:
						return `When ${params[1]} :`;
						break;
					case 403:
						return 'When Cancel :';
						break;
					case 404:
						return 'End';
						break;
					case 103:
						return  `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Input Number</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Input Number</h3>
									<div>
										<label for="103var">Variable :</label>
										<div class="wrapInputFilter relative" data-after="${$gameVariables.getName(params[0])} (${$gameVariables.value(params[0])})">
											<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-valType="int" 
												oninput="onVariableFilterConditionFocus(this);" onfocus="this.oninput();" 
												onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventCommandParam(this);"										
												type="text" class="inputFilter" id="varFilter" name="103var" value="${params[0]}" placeholder="0"
											/>
											<select onfocusout="onSelectFilteredConditionSelectFocusOut(this)" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
												class="selectFiltered" disabled>
											</select>
										</div>
									</div>
									<div>
										<label for="103digits">Digits :</label>
										<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="1" data-valType="int"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											type="number" min="1" max="8" placeholder="1" id="103digits" name="103digits" value="${params[1]}"
										>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 104:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Select Item</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Select Item</h3>
									<div>
										<label for="104var">Variable :</label>
										<div class="wrapInputFilter relative" data-after="${$gameVariables.getName(params[0])} (${$gameVariables.value(params[0])})">
											<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-valType="int" 
												oninput="onVariableFilterConditionFocus(this);" onfocus="this.oninput();" 
												onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventCommandParam(this);"										
												type="text" class="inputFilter" id="varFilter" name="104var" value="${params[0]}" placeholder="0"
											/>
											<select onfocusout="onSelectFilteredConditionSelectFocusOut(this)" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
												class="selectFiltered" disabled>
											</select>
										</div>
									</div>
									<div>
										<label for="104itemtype">Item Type :</label>
										<div class="select">
											<select data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="1" data-valType="int"
												onchange="changeEventCommandParam(this)"
												name="104itemtype" id="104itemtype"
											>
												<option value="1" ${params[1] === 1 ? 'selected' : ''}>Regular Item</option>
												<option value="2" ${params[1] === 2 ? 'selected' : ''}>Key Item</option>
												<option value="3" ${params[1] === 3 ? 'selected' : ''}>Hidden Item A</option>
												<option value="4" ${params[1] === 4 ? 'selected' : ''}>Hidden Item B</option>
											</select>
										</div>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 105:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Show Scrolling Text</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Show Scrolling Text</h3>
									<div>
										<label for="105speed">Speed :</label>
										<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-valType="int"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											type="number" min="1" max="8" placeholder="1" id="105speed" name="105speed" value="${params[0]}"
										>
									</div>
									<div>
										<label for="105fastforward" class="form-control">
											<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="1" data-valType="bool"
												onchange="changeEventCommandParam(this)"
												type="checkbox" id="105fastforward" name="105fastforward" ${params[1] === true ? 'checked' : ''}
											>
											No Fast Forward
										</label>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 405:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">${params[0].replace(/(\r\n|\n\r|\r|\n)/g, '<br>')}</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Show Text :</h3>
									<div>
										<label for="405text">Text :</label>
										<textarea data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0"
											onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
											class="textareaCommandData" id="405text" name="405text" placeholder="Enter text">${params[0]}</textarea>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`; 
						break;
					case 108:
						return `Comment :<i> ${params[0]}</i>`;
						break;
					case 408:
						return `Comment :<i> ${params[0]}</i>`;
						break;
					case 111:
						return 'Conditional Branch';
						break;
					case 411:
						return 'Else';
						break;
					case 412:
						return 'End Conditional Branch';
						break;
					case 112:
						return 'Loop';
						break;
					case 413:
						return 'Repeat Above';
						break;
					case 113:
						return 'Break Loop';
						break;
					case 115:
						return 'Exit Event Processing';
						break;
					case 117:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Common Event:<i> [${params[0]}] ${$dataCommonEvents[params[0]].name}</i></span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Common Event</h3>
									<div>
										<label for="117commonevent">Common Event :</label>
										<div class="wrapInputFilter relative" data-after="${$dataCommonEvents[params[0]].name}">
											<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-valType="int" 
												oninput="onCommonEventFilterConditionFocus(this);" onfocus="this.oninput();" 
												onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventCommandParam(this);"										
												type="text" class="inputFilter" id="CEFilter" name="117commonevent" value="${params[0]}" placeholder="0"
											/>
											<select onfocusout="onSelectFilteredConditionSelectFocusOut(this)" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
												class="selectFiltered" disabled>
											</select>
										</div>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 118:
						return `Label : <i>${params[0]}</i>`;
						break;
					case 119:
						return `Jump to Label : <i>${params[0]}</i>`;
						break;
					case 121:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Control Switches</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Control Switches</h3>
									<div>
										<label for="121switch1">From :</label>
										<div class="wrapInputFilter relative" data-after="${$gameSwitches.getName(params[0])}">
											<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-valType="int" 
												oninput="onSwitchFilterConditionFocus(this);" onfocus="this.oninput();" 
												onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventCommandParam(this);" 
												type="text" class="inputFilter" id="switchFilter" name="121switch1" value="${params[0]}" placeholder="0"
											/>
											<select onfocusout="onSelectFilteredConditionSelectFocusOut(this);" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
												class="selectFiltered" disabled>
											</select>
										</div>
									</div>
									<div>
										<label for="121switch2">To : <span class="fSize12">(must be >= to previous switch)</span></label>
										<div class="wrapInputFilter relative" data-after="${$gameSwitches.getName(params[1])}">
											<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="1" data-valType="int" 
												oninput="onSwitchFilterConditionFocus(this);" onfocus="this.oninput();" 
												onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventCommandParam(this);" 
												type="text" class="inputFilter" id="switchFilter" name="121switch2" value="${params[1]}" placeholder="0"
											/>
											<select onfocusout="onSelectFilteredConditionSelectFocusOut(this);" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
												class="selectFiltered" disabled>
											</select>
										</div>
									</div>
									<div>
										<p class="margin0">Operation : </p>		
										<div class="textCenter grid2col">
											<div>
												<label class="block" for="121operationon">ON</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
													onchange="changeEventCommandParam(this)" 
													type="radio" id="121operationon" name="121operation" value="0" ${params[2] === 0 ? 'checked' : ''}
												>
											</div>
											<div>
												<label class="block" for="121operationoff">OFF</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
													onchange="changeEventCommandParam(this)" 
													type="radio" id="121operationoff" name="121operation" value="1" ${params[2] !== 0 ? 'checked' : ''}
												>
											</div>
										</div>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 122:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Control Variables</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Control Variables</h3>
									<div>
										<label for="122var1">From :</label>
										<div class="wrapInputFilter relative" data-after="${$gameVariables.getName(params[0])}">
											<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-valType="int" 
												oninput="onSwitchFilterConditionFocus(this);" onfocus="this.oninput();" 
												onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventCommandParam(this);" 
												type="text" class="inputFilter" id="varFilter" name="122var1" value="${params[0]}" placeholder="0"
											/>
											<select onfocusout="onSelectFilteredConditionSelectFocusOut(this);" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
												class="selectFiltered" disabled>
											</select>
										</div>
									</div>
									<div>
										<label for="122var2">To : <span class="fSize12">(must be >= to previous var)</span></label>
										<div class="wrapInputFilter relative" data-after="${$gameVariables.getName(params[1])}">
											<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="1" data-valType="int" 
												oninput="onSwitchFilterConditionFocus(this);" onfocus="this.oninput();" 
												onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventCommandParam(this);" 
												type="text" class="inputFilter" id="varFilter" name="122var2" value="${params[1]}" placeholder="0"
											/>
											<select onfocusout="onSelectFilteredConditionSelectFocusOut(this);" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
												class="selectFiltered" disabled>
											</select>
										</div>
									</div>
									<div>
										<p class="margin0">Operation : </p>		
										<div class="textCenter customGrid" style="--grid-col-nb: 6; --grid-row-nb: 1;">
											<div>
												<label class="block" for="122operationset">Set</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
													onchange="changeEventCommandParam(this)" 
													type="radio" id="122operationset" name="122operation" value="0" ${params[2] === 0 ? 'checked' : ''}
												>
											</div>
											<div>
												<label class="block" for="122operationadd">Add</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
													onchange="changeEventCommandParam(this)" 
													type="radio" id="122operationadd" name="122operation" value="1" ${params[2] === 1 ? 'checked' : ''}
												>
											</div>
											<div>
												<label class="block" for="122operationsub">Sub</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
													onchange="changeEventCommandParam(this)" 
													type="radio" id="122operationsub" name="122operation" value="2" ${params[2] === 2 ? 'checked' : ''}
												>
											</div>
											<div>
												<label class="block" for="122operationmul">Mul</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
													onchange="changeEventCommandParam(this)" 
													type="radio" id="122operationmul" name="122operation" value="3" ${params[2] === 3 ? 'checked' : ''}
												>
											</div>
											<div>
												<label class="block" for="122operationdiv">Div</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
													onchange="changeEventCommandParam(this)" 
													type="radio" id="122operationdiv" name="122operation" value="4" ${params[2] === 4 ? 'checked' : ''}
												>
											</div>
											<div>
												<label class="block" for="122operationmod">Mod</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="2" data-valType="int"
													onchange="changeEventCommandParam(this)" 
													type="radio" id="122operationmod" name="122operation" value="5" ${params[2] === 5 ? 'checked' : ''}
												>
											</div>
										</div>
									</div>
									<div class="customGrid gridTemColMinAuto gridColGap5" style="--grid-row-nb: 1;">
										<form class="block margin0" onchange="triggerChildEvent(this, 'input:not(:checked)', 'ondeselect');">
											<p class="margin0 mBottom025">Operand : </p>		
											<div class="customGrid gridGap10" style="--grid-col-nb: 1; --grid-row-nb: 5; grid-template-rows: repeat(var(--grid-row-nb), 34px);">
												<div class="gridColGap5 gridColMinMax alignItemsCenter">
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="3" data-valType="int"
														onchange="changeEventCommandParam(this); toggleLinkedInput(this, '122const');" ondeselect="toggleLinkedInput(this, '122const');" 
														type="radio" id="122operandconst" name="122operand" value="0" ${params[3] === 0 ? 'checked' : ''}
													>
													<label for="122operandconst">Constant</label>
												</div>
												<div class="gridColGap5 gridColMinMax alignItemsCenter">
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="3" data-valType="int"
														onchange="changeEventCommandParam(this); toggleLinkedInput(this, '122var');" ondeselect="toggleLinkedInput(this, '122var');" 
														type="radio" id="122operandvar" name="122operand" value="1" ${params[3] === 1 ? 'checked' : ''}
													>
													<label for="122operandvar">Variable</label>
												</div>
												<div class="gridColGap5 gridColMinMax alignItemsCenter">
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="3" data-valType="int"
														onchange="changeEventCommandParam(this); toggleLinkedInput(this, '122randmin'); toggleLinkedInput(this, '122randmax');" ondeselect="toggleLinkedInput(this, '122randmin'); toggleLinkedInput(this, '122randmax');"
														type="radio" id="122operandrand" name="122operand" value="2" ${params[3] === 2 ? 'checked' : ''}
													>
													<label for="122operandrand">Random</label>
												</div>
												<div class="gridColGap5 gridColMinMax alignItemsCenter">
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="3" data-valType="int"
														onchange="changeEventCommandParam(this);" 
														type="radio" id="122operanddata" name="122operand" value="3" ${params[3] === 3 ? 'checked' : ''} disabled
													>
													<label for="122operanddata">Game Data</label>
												</div>
												<div class="gridColGap5 gridColMinMax alignItemsCenter">
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="3" data-valType="int"
														onchange="changeEventCommandParam(this); toggleLinkedInput(this, '122script');" ondeselect="toggleLinkedInput(this, '122script');" 
														type="radio" id="122operandscript" name="122operand" value="4" ${params[3] === 4 ? 'checked' : ''}
													>
													<label for="122operandscript">Script</label>
												</div>
											</div>
										</form>
										<div>
											<p class="margin0 mBottom025 whiteSpacePreWrap"> </p>
											<div class="customGrid gridGap10" style="--grid-col-nb: 1; --grid-row-nb: 5;">
												<div>
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="4" data-valType="int"
														onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
														type="number" placeholder="0" id="122const" name="122const" value="${params[4]}" ${params[3] !== 0 ? 'disabled' : ''}
													>
												</div>
												<div class="wrapInputFilter relative" data-after="${$gameVariables.getName(params[4])}">
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="4" data-valType="int" 
														oninput="onSwitchFilterConditionFocus(this);" onfocus="this.oninput();" 
														onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventCommandParam(this);" 
														type="text" class="inputFilter" id="122var" name="122var" value="${params[4]}" placeholder="0" ${params[3] !== 1 ? 'disabled' : ''}
													/>
													<select onfocusout="onSelectFilteredConditionSelectFocusOut(this);" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
														class="selectFiltered" disabled>
													</select>
												</div>
												<div class="customGrid" style="--grid-col-nb: 2; --grid-row-nb: 1;">
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="4" data-valType="int"
														onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
														type="number" placeholder="0" id="122randmin" name="122randmin" value="${params[4]}" ${params[3] !== 2 ? 'disabled' : ''}
													>
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="5" data-valType="int"
														onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
														type="number" placeholder="0" id="122randmax" name="122randmax" value="${params[5] || 0}" ${params[3] !== 2 ? 'disabled' : ''}
													>
												</div>
												<div>
													
												</div>
												<div>
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="4"
														onchange="changeEventCommandParam(this)" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" 
														type="text" placeholder="0" id="122script" name="122script" value="${params[4]}" ${params[3] !== 4 ? 'disabled' : ''}
													>
												</div>
											</div>
										</div>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 123:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Control Self Switch</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Control Self Switch</h3>
									<div>
										<p class="margin0">Self Switch : </p>
										<div class="select">
											<select data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0"
												onfocus="updateSelfSwitchConditionOptionsColours(this);" onchange="changeEventCommandParam(this)" 
												id="123selfswitch" name="123selfswitch"
											>
												<option value="A" ${params[0] === "A" ? 'selected="selected"' : ''}>A</option>
												<option value="B" ${params[0] === "B" ? 'selected="selected"' : ''}>B</option>
												<option value="C" ${params[0] === "C" ? 'selected="selected"' : ''}>C</option>
												<option value="D" ${params[0] === "D" ? 'selected="selected"' : ''}>D</option>
											</select>
											<span class="focus"></span>
										</div>
									</div>
									<div>
										<p class="margin0">Operation : </p>
										<div class="textCenter grid2col">
											<div>
												<label class="block" for="123operationon">ON</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="1" data-valType="int"
													onchange="changeEventCommandParam(this);" 
													type="radio" id="123operationon" name="123operation" value="0" ${params[1] === 0 ? 'checked' : ''}
												>
											</div>
											<div>
												<label class="block" for="123operationoff">OFF</label>
												<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="1" data-valType="int"
													onchange="changeEventCommandParam(this)" 
													type="radio" id="123operationoff" name="123operation" value="1" ${params[1] !== 0 ? 'checked' : ''}
												>
											</div>
										</div>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 124:
						return `
							<span class="block hasEventCommandData" onclick="showEventCommandData(this)">Control Timer</span>
							<div class="eventCommandData uncollapsed">
								<div class="gridGap15 padding20">
									<h3 class="margin0">Control Timer</h3>
									<div>
										<p class="margin0">Operation :</p>
										<form class="block margin0" onchange="triggerChildEvent(this, 'input:not(:checked)', 'ondeselect');">
											<div class="textCenter grid2col">
												<div>
													<label class="block" for="124operationon">Start</label>
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-valType="int"
														onchange="changeEventCommandParam(this); toggleLinkedInput(this, '124time');" ondeselect="toggleLinkedInput(this, '124time');" 
														type="radio" id="124operationon" name="124operation" value="0" ${params[0] === 0 ? 'checked' : ''}
													>
												</div>
												<div>
													<label class="block" for="124operationoff">Stop</label>
													<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="0" data-valType="int"
														onchange="changeEventCommandParam(this);" 
														type="radio" id="124operationoff" name="124operation" value="1" ${params[0] !== 0 ? 'checked' : ''}
													>
												</div>
											</div>
										</form>
									</div>
									<div>
										<p class="margin0">Time :</p>		
										<div>
											<label class="block" for="124time">Second</label>
											<input data-eventId="${eventId}" data-pageId="${pageId}" data-commandIndex="${commandIndex}" data-paramIndex="1" data-valType="int"
												onchange="changeEventCommandParam(this)" 
												type="number" min="0" id="124time" name="124time" value="${params[1]}" ${params[0] !== 0 ? 'disabled' : ''}
											>
										</div>
									</div>
									<span class="closeEventCommandData" onclick="hideEventCommandData(this)"></span>
								</div>
							</div>`;
						break;
					case 125:
						return 'Change Gold';
						break;
					case 126:
						return 'Change Items';
						break;
					case 127:
						return 'Change Weapons';
						break;
					case 128:
						return 'Change Armors';
						break;
					case 129:
						return 'Change Party Member';
						break;
					case 132:
						return 'Change Battle BGM';
						break;
					case 133:
						return 'Change Victory ME';
						break;
					case 134:
						return 'Change Save Access';
						break;
					case 135:
						return 'Change Menu Access';
						break;
					case 136:
						return 'Change Encounter';
						break;
					case 137:
						return 'Change Formation Access';
						break;
					case 138:
						return 'Change Window Color';
						break;
					case 139:
						return 'Change Defeat ME';
						break;
					case 140:
						return 'Change Vehicle BGM';
						break;
					case 201:
						return 'Transfer Player';
						break;
					case 202:
						return 'Set Vehicle Location';
						break;
					case 203:
						return 'Set Event Location';
						break;
					case 204:
						return 'Scroll Map';
						break;
					case 205:
						return 'Set Movement Route';
						break;
					case 505:
						return getCommandData(params[0].code);
						break;
					case 206:
						return 'Get on/off Vehicle';
						break;
					case 211:
						return 'Change Transparency';
						break;
					case 212:
						return 'Show Animation';
						break;
					case 213:
						return 'Show Balloon Icon';
						break;
					case 214:
						return 'Erase Event';
						break;
					case 216:
						return 'Change Player Followers';
						break;
					case 217:
						return 'Gather Followers';
						break;
					case 221:
						return 'Fadeout Screen';
						break;
					case 222:
						return 'Fadein Screen';
						break;
					case 223:
						return 'Tint Screen';
						break;
					case 224:
						return 'Flash Screen';
						break;
					case 225:
						return 'Shake Screen';
						break;
					case 230:
						return 'Wait';
						break;
					case 231:
						return 'Show Picture';
						break;
					case 232:
						return 'Move Picture';
						break;
					case 233:
						return 'Rotate Picture';
						break;
					case 234:
						return 'Tint Picture';
						break;
					case 235:
						return 'Erase Picture';
						break;
					case 236:
						return 'Set Weather Effect';
						break;
					case 241:
						return 'Play BGM';
						break;
					case 242:
						return 'Fadeout BGM';
						break;
					case 243:
						return 'Save BGM';
						break;
					case 244:
						return 'Resume BGM';
						break;
					case 245:
						return 'Play BGS';
						break;
					case 246:
						return 'Fadeout BGS';
						break;
					case 249:
						return 'Play ME';
						break;
					case 250:
						return 'Play SE';
						break;
					case 251:
						return 'Stop SE';
						break;
					case 261:
						return 'Play Movie';
						break;
					case 281:
						return 'Change Map Name Display';
						break;
					case 282:
						return 'Change Tileset';
						break;
					case 283:
						return 'Change Battle Background';
						break;
					case 284:
						return 'Change Parallax';
						break;
					case 285:
						return 'Get Location Info';
						break;
					case 301:
						return 'Battle Processing';
						break;
					case 601:
						return 'If Win';
						break;
					case 602:
						return 'If Escape';
						break;
					case 603:
						return 'If Lose';
						break;
					case 302:
						return 'Shop Processing';
						break;
					case 303:
						return 'Name Input Processing';
						break;
					case 311:
						return 'Change HP';
						break;
					case 312:
						return 'Change MP';
						break;
					case 326:
						return 'Change TP';
						break;
					case 313:
						return 'Change State';
						break;
					case 314:
						return 'Recover All';
						break;
					case 315:
						return 'Change EXP';
						break;
					case 316:
						return 'Change Level';
						break;
					case 317:
						return 'Change Parameter';
						break;
					case 318:
						return 'Change Skill';
						break;
					case 319:
						return 'Change Equipment';
						break;
					case 320:
						return 'Change Name';
						break;
					case 321:
						return 'Change Class';
						break;
					case 322:
						return 'Change Actor Images';
						break;
					case 323:
						return 'Change Vehicle Image';
						break;
					case 324:
						return 'Change Nickname';
						break;
					case 325:
						return 'Change Profile';
						break;
					case 331:
						return 'Change Enemy HP';
						break;
					case 332:
						return 'Change Enemy MP';
						break;
					case 342:
						return 'Change Enemy TP';
						break;
					case 333:
						return 'Change Enemy State';
						break;
					case 334:
						return 'Enemy Recover All';
						break;
					case 335:
						return 'Enemy Appear';
						break;
					case 336:
						return 'Enemy Transform';
						break;
					case 337:
						return 'Show Battle Animation';
						break;
					case 339:
						return 'Force Action';
						break;
					case 340:
						return 'Abort Battle';
						break;
					case 351:
						return 'Open Menu Screen';
						break;
					case 352:
						return 'Open Save Screen';
						break;
					case 353:
						return 'Game Over';
						break;
					case 354:
						return 'Return to Title Screen';
						break;
					case 355:
						return 'Script';
						break;
					case 356:
						return 'Plugin Command MV (deprecated)';
						break;
					case 357:
						return 'Plugin Command';
						break;
					default:
						return 'Unknown';
						break;
				}
			};
			
			//----------------------------------------------------------------------
			//map view
			
			function initMap() {
				view.setAttribute('data-view', 'map');
				let viewHTML = getViewHeader('map');
				const mapAvailable = isMapAvailable();
				viewHTML += `
					<div data-mapID="${$gameMap.mapId()}" id="content">
						${getMapHeader()}
						<h3 class="textCenter">Map Tools :</h3>
						<div id="mapTools" class="textCenter">
							<button id="buttonGrid" data-grid="${Drag.Debugger.grid !== null ? 'true' : 'false'}" onclick="toggleGrid(); updateMap();" ${isMapAvailable() ? '' : 'disabled'}></button>
							<button id="buttonCollisions" data-collisions="${Drag.Debugger.collisions !== null ? 'true' : 'false'}" onclick="toggleCollisions(); updateMap();" ${isMapAvailable() ? '' : 'disabled'}></button>
							<button id="buttonRegionsId" data-regionsId="${Drag.Debugger.regionsId !== null ? 'true' : 'false'}" onclick="toggleRegionIds(); updateMap();" ${isMapAvailable() ? '' : 'disabled'}></button>
						</div>
						<h3 class="textCenter">Minimap Tools :</h3>
						<div id="mapTools" class="textCenter">
							<button id="buttonMinimapCollision" data-collisions="false" onclick="toggleMinimapCollisions(this);" ${isMapAvailable() ? '' : 'disabled'}></button>
							<button id="buttonMinimapRegionsId" data-regionsId="false" onclick="toggleMinimapRegionIds(this);" ${isMapAvailable() ? '' : 'disabled'}></button>
						</div>
						<h3 class="textCenter">Minimap :</h3>
						<div id="minimapContainer" data-isMapAvailable="${mapAvailable}">
							${mapAvailable ? getMinimap() : 'No map detected.'}
						</div>
						<div id="tileSelectedData" class="hidden mBottom2"></div>
					</div>`;
				view.innerHTML = viewHTML;
			};
			
			function getMinimap() {
				let minimap = "";
				const mapWidth = $gameMap.width();
				const mapHeight = $gameMap.height();
				for (let x = 0; x < mapWidth; x++) {
					for (let y = 0; y < mapHeight; y++) {
						const hasEvent = $gameMap.eventsXy(x, y).map(obj => obj.eventId()).toString() || 0; 
						const hasEventId = $gameMap.eventIdXy(x, y);
						const hasPlayer = $gamePlayer.x === x && $gamePlayer.y === y;
						const bottomPassable = Drag.Debugger.isPassable(x, y, 2);
						const leftPassable = Drag.Debugger.isPassable(x, y, 4);
						const rightPassable = Drag.Debugger.isPassable(x, y, 6);
						const topPassable = Drag.Debugger.isPassable(x, y, 8);
						const regionId = $gameMap.regionId(x, y);
						minimap += `
							<div class="minimapTile" onmouseover="showMinimapData(this);" onmouseout="hideMinimapData();" onclick="selectMiniMapTile(this);"
								data-bPassable="${bottomPassable}" data-lPassable="${leftPassable}" data-rPassable="${rightPassable}" data-tPassable="${topPassable}"
								data-regionId="${regionId}"
								data-x="${x}" data-y="${y}" data-hasPlayer="${hasPlayer}" data-hasEvent="${hasEvent}" data-selected="false"
								style="--x: ${x}; --y: ${y}; --regionId-background-color: ${regionId > 0 ? Drag.Debugger.regionsIdsColours[regionId % Drag.Debugger.regionsIdsColours.length] : 'var(--color)'}">
							</div>`;
					}
				}
				return `
					<div id="minimap" style="--map-width: ${mapWidth}; --map-height: ${mapHeight};">
						<span id="minimapData"></span>
						${minimap}
					</div>
				`;
			};
			
			function updateMap() {
				const mapAvailable = isMapAvailable();
				for (toolButton of view.querySelectorAll("#mapTools button")) {
					toolButton.disabled = !mapAvailable;
					if (toolButton.id === "buttonGrid") {
						let currentDataGrid = toolButton.getAttribute('data-grid') === "true";
						let dataGrid = Drag.Debugger.grid !== null;
						if (dataGrid !== currentDataGrid)
							toolButton.setAttribute('data-grid', dataGrid);
					}
					
					if (toolButton.id === "buttonCollisions") {
						let currentDataCollisions = toolButton.getAttribute('data-collisions') === "true";
						let dataCollisions = Drag.Debugger.collisions !== null;
						if (dataCollisions !== currentDataCollisions)
							toolButton.setAttribute('data-collisions', dataCollisions);
					}
					
					if (toolButton.id === "buttonRegionsId") {
						let currentDataRegionsId = toolButton.getAttribute('data-regionsId') === "true";
						let dataRegionsId = Drag.Debugger.regionsId !== null;
						if (dataRegionsId !== currentDataRegionsId)
							toolButton.setAttribute('data-regionsId', dataRegionsId);
					}
				}
				
				let minimapContainer = view.querySelector("#minimapContainer");
				let currentMapAvailable = minimapContainer.getAttribute('data-isMapAvailable') === 'true';
				if (currentMapAvailable !== mapAvailable) {
					minimapContainer.setAttribute('data-isMapAvailable', mapAvailable);
					if (mapAvailable)
						minimapContainer.innerHTML = getMinimap();
					else 
						`No map detected.`;
				}
				if (mapAvailable)
					updateMinimap();
				
				let tileSelectedData = view.querySelector('#tileSelectedData:not(.hidden)');
				if (tileSelectedData) {
					let eEvents = document.querySelectorAll('#content .evData');
					if (!(eEvents?.length > 0))
						return;
					for (eEvent of eEvents)
						updateEvent(eEvent);
				}
			};
			
			function updateMinimap() {
				let minimap = view.querySelector('#minimap');
				
				for (ev of $gameMap.events()) {
					let currentEvTile = minimap.querySelector(`.minimapTile[data-x="${ev.x}"][data-y="${ev.y}"]`);
					if (!currentEvTile)
						continue;
					const currentHasEvent = currentEvTile.getAttribute('data-hasEvent').split(",").map(obj => Number(obj));
					if (!currentHasEvent.includes(ev.eventId())) {
						for (minimapTile of minimap.querySelectorAll(`.minimapTile[data-hasEvent]:not([data-hasEvent="0"])`)) {
							let minimapTileHasEvent = minimapTile.getAttribute('data-hasEvent').split(",").map(obj => Number(obj));
							if (minimapTileHasEvent.includes(ev.eventId())) {
								minimapTileHasEvent.splice(minimapTileHasEvent.indexOf(ev.eventId()), 1);
								if (minimapTileHasEvent.length === 0)
									minimapTileHasEvent = [0];
								minimapTile.setAttribute('data-hasEvent', minimapTileHasEvent.toString());
							}
						}
						const hasEvent = $gameMap.eventsXy(ev.x, ev.y).map(obj => obj.eventId()).toString() || 0; 
						currentEvTile.setAttribute('data-hasEvent', hasEvent);
					}
				}
				
				let currentPlayerTile = minimap.querySelector(`.minimapTile[data-hasPlayer="true"]`);
				if (!currentPlayerTile)
					return;
				let playerHasMoved = ($gamePlayer.x !== parseInt(currentPlayerTile.getAttribute('data-x'))) || ($gamePlayer.y !== parseInt(currentPlayerTile.getAttribute('data-y')));
				if (playerHasMoved) {
					currentPlayerTile.setAttribute('data-hasPlayer', "false");
					let newPlayerTile = minimap.querySelector(`.minimapTile[data-x="${$gamePlayer.x}"][data-y="${$gamePlayer.y}"]`);
					newPlayerTile.setAttribute('data-hasPlayer', "true");
				}
				
				if (!minimap.classList.contains('collisionEnabled') && !minimap.classList.contains('regionIdEnabled'))
					return;
				for (minimapTile of minimap.querySelectorAll('.minimapTile')) {
					const x = parseInt(minimapTile.getAttribute('data-x'));
					const y = parseInt(minimapTile.getAttribute('data-y'));
					
					if (minimap.classList.contains('collisionEnabled')) {
						const bottomPassable = Drag.Debugger.isPassable(x, y, 2);
						const leftPassable = Drag.Debugger.isPassable(x, y, 4);
						const rightPassable = Drag.Debugger.isPassable(x, y, 6);
						const topPassable = Drag.Debugger.isPassable(x, y, 8);
						
						if (bottomPassable !== (minimapTile.getAttribute('data-bPassable') === true))
							minimapTile.setAttribute('data-bPassable', bottomPassable);
						if (leftPassable !== (minimapTile.getAttribute('data-lPassable') === true))
							minimapTile.setAttribute('data-lPassable', leftPassable);
						if (rightPassable !== (minimapTile.getAttribute('data-rPassable') === true))
							minimapTile.setAttribute('data-rPassable', rightPassable);
						if (topPassable !== (minimapTile.getAttribute('data-tPassable') === true))
							minimapTile.setAttribute('data-tPassable', topPassable);
					}
					
					if (minimap.classList.contains('regionIdEnabled')) {
						const regionId = $gameMap.regionId(x, y);
						if (regionId !== parseInt(minimapTile.getAttribute('data-regionId')))
							minimapTile.setAttribute('data-regionId', regionId);
					}
				}
			};
			
			function selectMiniMapTile(minimapTile) {
				let minimap = view.querySelector('#minimap');
				minimap.querySelector('.minimapTile[data-selected="true"]')?.setAttribute('data-selected', false);
				minimapTile.setAttribute('data-selected', true);
				
				let tileSelectedData = view.querySelector('#tileSelectedData');
				tileSelectedData.classList.remove("hidden");
				const xMinimapTile = parseInt(minimapTile.getAttribute('data-x')); 
				const yMinimapTile = parseInt(minimapTile.getAttribute('data-y'));
				let tileSelectedDataHTML = `<h3 class='textCenter'>Data Minimap Selected Tile :</h3>`;
				
				const bottomPassable = Drag.Debugger.isPassable(xMinimapTile, yMinimapTile, 2);
				const leftPassable = Drag.Debugger.isPassable(xMinimapTile, yMinimapTile, 4);
				const rightPassable = Drag.Debugger.isPassable(xMinimapTile, yMinimapTile, 6);
				const topPassable = Drag.Debugger.isPassable(xMinimapTile, yMinimapTile, 8);
				const regionId = $gameMap.regionId(xMinimapTile, yMinimapTile);
				tileSelectedDataHTML += `
					<div class="textCenter fRight w30P">
						<span>
							<b>Position : </b>
						</span>
						<br>
						<span class="fSize20 xy">[x: ${xMinimapTile}, y: ${yMinimapTile}]</span>
						<br>
						<button class="bTpEvent button mTop1" data-xy="${xMinimapTile},${yMinimapTile}" onclick="teleportPlayerTo(this); refreshView();">Teleport To</button>
					</div>
					<div class="tileData fRight" 
						data-bPassable="${bottomPassable}" data-lPassable="${leftPassable}" data-rPassable="${rightPassable}" data-tPassable="${topPassable}"
						data-regionId="${regionId}" style="background-color: ${regionId > 0 ? Drag.Debugger.regionsIdsColours[regionId % Drag.Debugger.regionsIdsColours.length] : 'transparent'}">
					</div>
					<div class="clearfix"></div>
					`;
				
				let minimapTileHasEvent = minimapTile.getAttribute('data-hasEvent').split(",").map(obj => Number(obj));
				for (eventId of minimapTileHasEvent) {
					if (eventId === 0)
						continue;
					let event = $gameMap.event(eventId);
					let eventName = event.event().name;
					let activePage = Drag.Debugger.getActivePage(eventId);
					tileSelectedDataHTML += `
						<div data-eventId="${eventId}" class="evData">
							<div class="grid2row">
								${getEventHeader(eventId, eventName)}
								<div>
									${getEventGeneralInfos($gameMap.event(eventId))}
					`;
					let status = [];
					if (Drag.Debugger.getPagesByTrigger(3, event).length > 0)
						status = Drag.Debugger.checkAutorunEvent(event);
					for (let i = 0; i <  $gameMap.event(eventId).event().pages.length; i++)
						tileSelectedDataHTML += `
									<div data-pageId="${i}" class="evPages evPage${i}">
										${getEventElemPageHeader(i, event)}
										<div class="transitionAll025 ${(i === activePage ) ? '' : 'uncollapsed'}">
											${getEventElemOptions(i, event)}
											${getEventElemConditions(i, $gameMap.mapId(), event)}
										</div>
										${(status.length > 0 && status[1] === i)? 
										'<div data-warnCode="' + status[0] + '" data-warnPageId="' + status[1] + '" class="warnAutorun">' + getAutorunEventHelp(status) + '</div>'
										: 
										''}
									</div>`;
					tileSelectedDataHTML += `
								</div>
							</div>
						</div>
					`;
				}
				tileSelectedData.innerHTML = tileSelectedDataHTML;
			};
			
			function showMinimapData(minimapTile) {
				let minimap = view.querySelector('#minimap');
				let minimapData = minimap.querySelector("#minimapData");
				const xMinimapTile = parseInt(minimapTile.getAttribute('data-x'));
				const yMinimapTile = parseInt(minimapTile.getAttribute('data-y'));
				const hasEventMinimapTile = minimapTile.getAttribute('data-hasEvent');
				minimapData.innerHTML = `[x: ${xMinimapTile}, y: ${yMinimapTile}]<br>Events : ${hasEventMinimapTile}`;
				minimapData.style.visibility = "visible";
				minimapData.style.opacity = 255;
				let left = minimapTile.offsetLeft + 20;
				let top = minimapTile.offsetTop + 20;
				if (left + minimapData.offsetWidth > minimap.offsetWidth)
					left = left - minimapData.offsetWidth - 20;
				if (top + minimapData.offsetHeight > minimap.offsetHeight)
					top = top - minimapData.offsetHeight - 20;
				minimapData.style.left = left + "px";
				minimapData.style.top = top + "px";
			};
			
			function hideMinimapData() {
				let minimap = view.querySelector('#minimap');
				let minimapData = minimap.querySelector("#minimapData");
				minimapData.style.visibility = "hidden";
				minimapData.style.opacity = 0;
			};
			
			function toggleGrid() {
				Drag.Debugger.toggleGrid();
			};
			
			function toggleCollisions() {
				Drag.Debugger.toggleCollisions();
			};
			
			function toggleMinimapCollisions(button) {
				view.querySelector('#minimap').classList.toggle('collisionEnabled');
				button.setAttribute('data-collisions', !(button.getAttribute('data-collisions') === "true"));
			};
			
			function toggleRegionIds() {
				Drag.Debugger.toggleRegionIds();
			};
			
			function toggleMinimapRegionIds(button) {
				view.querySelector('#minimap').classList.toggle('regionIdEnabled');
				button.setAttribute('data-regionsId', !(button.getAttribute('data-regionsId') === "true"));
			};
			
			function isMapAvailable() {
				return $gameMap.mapId() > 0 && $dataMap && $dataMap.mapId > 0;
			};
			
			//----------------------------------------------------------------------
			//player view
			
			function initPlayer() {
				view.setAttribute('data-view', 'player');
				let viewHTML = getViewHeader('player');
				viewHTML += `
						${getPlayerHeader()}
						<div id="infos">
							<div id="playerInfos">
								<p><b>Player Position :</b> <span id="ppx"></span><span id="ppy"></span><span id="pri"></span></p>
								<p><b>Cursor Position :</b> <span id="cpx"></span><span id="cpy"></span><span id="cri"></span></p>
							</div>
						</div>
						`;
				view.innerHTML = viewHTML;
			};
			
			function updatePlayer() {
				
				let x = $gamePlayer.x;
				let y = $gamePlayer.y;
				let ri = 0;
				if ($dataMap)
					ri = $gameMap.regionId(x, y);
				document.getElementById("ppx").innerHTML = "x: " + x;
				document.getElementById("ppy").innerHTML = ", y: " + y;
				document.getElementById("pri").innerHTML = ", region ID: " + ri;
				
				x, y, ri = 0;
				if ($dataMap) {
					x = $gameMap.canvasToMapX(window.opener.TouchInput.x)
					y = $gameMap.canvasToMapY(window.opener.TouchInput.y)
					ri = $gameMap.regionId(x, y);
				}
				document.getElementById("cpx").innerHTML = "x: " + x;
				document.getElementById("cpy").innerHTML = ", y: " + y;
				document.getElementById("cri").innerHTML = ", region ID: " + ri;
				
			};
			
			//----------------------------------------------------------------------
			//switches view
			
			function initSwitches() {
				view.setAttribute('data-view', 'switches');
				let viewHTML = getViewHeader('switches');
				viewHTML += `<br><div id="content">`; //class="grid3"

				for ([switchId, switchName] of $dataSystem.switches.entries()) {
					if (switchId > 0) {
						let switchValue = $gameSwitches.value(switchId) === true ? "checked" : "";
						let color = $gameSwitches.value(switchId) === true ? "bgGreen" : "bgRed";
						viewHTML += getSwitchElem2(switchId, switchName, switchValue, color);
					}
				}
				viewHTML += "</div>";
				view.innerHTML = viewHTML;
			};
			
			function getSwitchElem2(switchId, switchName, switchValue, color) {
				return `
					<div data-switchId="${switchId}" class="switch ${switchValue ? 'switchOn' : 'switchOff'}">
						<div class="textCenter">
							<hr class="divider3 ${switchValue ? 'linearBackgroundGreen' : 'linearBackgroundRed'}"> 
							<h4 data-switchId="${switchId}" onclick="toggleSwitch(${switchId}); refreshView();" class="marginAuto pointer">
								<span class="squareTitle padding5 floatLeft paddingB15 bgRoot colorRoot borderColorRoot marginR5">
									${(switchId)}
								</span>
								<input class="toggle val floatLeft" type="checkbox" ${switchValue}/>
								${ switchName !== '' ? '<span class="squareTitle padding5 floatLeft paddingB15 bgRoot colorRoot borderColorRoot marginL5">' + switchName + '</span>' : ''}
								
								${ switchId < 2 ? '<span class="switchId">ID:</span>' : ''}
								${ (switchName !== '' && switchId < 2) ? '<span class="switchName">Name:</span>' : ''}
							</h4>
						</div>
					</div>`;
			};
			
			function getSwitchElem(switchId, switchName, switchValue, color) {
				return `
					<span data-switchId="${switchId}" onclick="toggleSwitch(${switchId}); refreshView();" class="switch ${color}">
						<span class="switchHeader padding0 bold fontSansSerif">
							<span class="square block">${switchId}</span> 
							<span class="block padding5">${switchName}</span>
						</span>
						<input class="toggle val" type="checkbox" ${switchValue}/>
					</span>`;
			};
			
			function updateSwitches() {				
				let eSwitches = document.querySelectorAll('.switch');
				if (!(eSwitches?.length > 0))
					return;
				let showNamelessSwitches = document.getElementById("showNamelessSwitches").checked;
				let showNamedSwitches = document.getElementById("showNamedSwitches").checked;
				let filterSwitches = document.getElementById("filterSwitches").value.toLowerCase();
				let showONOnly = document.getElementById("showONOnly").checked;
				let showOFFOnly = document.getElementById("showOFFOnly").checked;
				for (let eSwitch of eSwitches) {
					let switchId = parseInt(eSwitch.getAttribute("data-switchId"));
					let switchValue = $gameSwitches.value(switchId);
					if (switchValue) {
						eSwitch.classList.remove("switchOff");
						eSwitch.classList.add("switchOn");						
					} else {
						eSwitch.classList.remove("switchOn");
						eSwitch.classList.add("switchOff");
					}
					let switchName = $gameSwitches.getName(switchId);
					if (
					(switchName !== "" && showNamelessSwitches) 
					|| (switchName === "" && showNamedSwitches)
					|| (switchId != filterSwitches && !switchName.toLowerCase().includes(filterSwitches))
					|| (showONOnly && !switchValue)
					|| (showOFFOnly && switchValue)
					)
						eSwitch.classList.add("hidden");
					else
						eSwitch.classList.remove("hidden");
					eSwitch.querySelectorAll('.val')[0].checked = switchValue;
				}
			};
			
			function toggleSwitch(switchId) {
				if (!switchId)
					return;
				$gameSwitches.setValue(switchId, !$gameSwitches.value(switchId));
			};
			
			//----------------------------------------------------------------------
			//variables view
			
			function initVariables() {
				view.setAttribute('data-view', 'variables');
				let viewHTML = getViewHeader('variables');
				viewHTML += `<br><div id="content">`;
				for (let [varId, varName] of $dataSystem.variables.entries()) {
					if (varId > 0) {
						let varValue = $gameVariables.value(varId) || 0;
						viewHTML += getVariableElem2(varId, varName, varValue);
					}
				}
				viewHTML += "</div>";
				view.innerHTML = viewHTML;
			};
			
			function getVariableElem2(varId, varName, varValue) {
				return `
					<div data-varId="${varId}" class="var">
						<div class="textCenter">
							<hr class="dividerVar"> 
							<h4 class="marginAuto pointer">
								<div class="grid3">
									<div class="textRight relative">
										<span class="squareTitle padding5 hAuto bgRoot colorRoot borderColorRoot marginR5">${(varId)}</span>
										${ varId < 2 ? '<span class="varId">ID:</span>' : ''}
									</div>
									<input onpaste="this.oninput();" oninput="setVariable(${varId}, this.value); animateVariableInput(this);" class="val" type="text" value="${varValue}">
									<div class="textLeft relative">
										${ varName !== '' ? '<span class="squareTitle padding5 hAuto bgRoot colorRoot borderColorRoot marginL5">' + varName + '</span>' : ''}
										${ (varName !== '' && varId < 2) ? '<span class="varName">Name:</span>' : ''}
									</div>
								</div>
							</h4>
						</div>
					</div>`;
			};
			
			var intervalIDAnimationVariableInput;
			function animateVariableInput(elem) {
				if (!elem.parentNode.parentNode.parentNode.parentNode.classList.contains("animationVariableInput")) {
					elem.parentNode.parentNode.parentNode.parentNode.classList.add("animationVariableInput");
					intervalIDAnimationVariableInput = setTimeout(removeAnimationVariableInput, 1000, elem.parentNode.parentNode.parentNode.parentNode);
				} else {
					clearInterval(intervalIDAnimationVariableInput);
					intervalIDAnimationVariableInput = setTimeout(removeAnimationVariableInput, 1000, elem.parentNode.parentNode.parentNode.parentNode);
				}
			};
			
			function removeAnimationVariableInput(elem) {
				elem.classList.remove("animationVariableInput");
				intervalIDAnimationVariableInput = null;
			};
			
			function getVariableElem(varId, varName, varValue) {
				return `
					<label data-varId="${varId}" class="form-control-text var">
						<span class="varHeader">
							<span class="square">${varId}</span>
							${varName}
						</span>
						<input onchange="setVariable(${varId}, this.value)" class="val" type="text" value="${varValue}">
					</label>`;
			};
			
			function updateVariables() {
				let eVariables = document.querySelectorAll('.var');
				if (!(eVariables?.length > 0))
					return;
				let showNamelessSwitches = document.getElementById("showNamelessVariables").checked;
				let showEmptyVariables = document.getElementById("showEmptyVariables").checked;
				let filterVariables = document.getElementById("filterVariables").value.toLowerCase();
				for (eVariable of eVariables) {
					let varId = parseInt(eVariable.getAttribute("data-varId"));
					let varValue = $gameVariables.value(varId) || 0;
					let varName = $gameVariables.getName(varId);
					if (
					(varName === "" && !showNamelessSwitches)
					|| (!showEmptyVariables && !varValue)
					|| (varId != filterVariables && !varName.toLowerCase().includes(filterVariables))
					)
						eVariable.classList.add("hidden");
					else
						eVariable.classList.remove("hidden");
					let eVal = eVariable.querySelectorAll('.val')[0]; 
					if (eVal.value != varValue) {
						eVal.value = varValue;
						animateVariableInput(eVal);
					}
				}
			};
			
			//----------------------------------------------------------------------
			//self switches view
			
			function initSelfSwitches() {
				view.setAttribute('data-view', 'self-switches');
				let mapId = $gameMap.mapId();
				let viewHTML = getViewHeader('self-switches') + getMapHeader(mapId);
				viewHTML += `<div data-mapID="${mapId}" id="content"><ul>`;
				let letters = ["A", "B", "C", "D"]
				if ($gameMap.events().length < 1) 
					viewHTML += "<p><b>No event was detected.</b></p>";
				else 
					viewHTML += `<p><b>${$gameMap.events().length} event(s) detected :</b>`;
				for (event of $gameMap.events()) {
					let eventId = event._eventId;
					let eventName = $gameMap.event(eventId).event().name;
					viewHTML += `
					<li data-eventId="${eventId}" class="evData marginB05EM">
						<div class="grid2row">
							${getEventHeader(eventId, eventName)}
							<div class="grid4">`;
					for (letter of letters) {
						let selfSwitchIndex = `${mapId},${eventId},${letter}`;
						let switchValue = $gameSelfSwitches.value(selfSwitchIndex);
						let color = switchValue === true ? "bgGreen" : "bgRed";
						switchValue = switchValue === true ? "checked" : "";
						viewHTML += getSelfSwitchElem(selfSwitchIndex, letter, switchValue, color);
					}
					viewHTML += `
							</div>
						</div>
					</li>`;
				}
				viewHTML += "</ul></div>";
				view.innerHTML = viewHTML;
			};
			
			function getSelfSwitchElem(selfSwitchIndex, letter, switchValue, color) {
				return `
					<span data-self-switches="${selfSwitchIndex}" onclick="toggleSelfSwitch('${selfSwitchIndex}')" class="selfSwitch ${switchValue ? 'selfSwitchOn' : 'selfSwitchOff'}"> 
						<span class="switchHeader block marginB5">
							<span class="square marginAuto block w15 bgWhite">${letter}</span>
						</span>
						<input class="toggle val block marginAuto" type="checkbox" ${switchValue}/>
					</span>`;
			};
			
			function updateSelfSwitches() {	
				let currentMapId = parseInt(document.getElementById("content").getAttribute("data-mapID"));
				let mainWindow = window.opener;
				let mapId = $gameMap.mapId();
				if (currentMapId !== mapId) {
					if ($dataMap?.mapId !== currentMapId && $dataMap?.mapId > 0)
						initSelfSwitches(view);
				} else {
					let eEvents = document.querySelectorAll('#content .evData');
					if (!(eEvents?.length > 0))
						return;
					let showONOnly = document.getElementById('showONOnly').checked;
					let showOFFOnly = document.getElementById('showOFFOnly').checked;
					let filterSelfSwitches = document.getElementById("filterSelfSwitches").value.toLowerCase();
					for (eEvent of eEvents) {
						let eSwitchs = eEvent.querySelectorAll('.selfSwitch');
						if (!(eSwitchs?.length > 0))
							return;
						let eventId = parseInt(eEvent.getAttribute('data-eventId'));
						let gameEvent = $gameMap.event(eventId);
						if (!gameEvent)
							return;
						let eventName = gameEvent.event().name;
						let hasSwitchOn = false;
						let hasSwitchOFF = false;
						for (eSwitch of eSwitchs) {
							let selfSwitchIndex = eSwitch.getAttribute("data-self-switches");
							let switchValue = $gameSelfSwitches.value(selfSwitchIndex);
							if (switchValue) {
								eSwitch.classList.remove("selfSwitchOff");
								eSwitch.classList.add("selfSwitchOn");
								hasSwitchOn = true;
							} else {
								eSwitch.classList.remove("selfSwitchOn");
								eSwitch.classList.add("selfSwitchOff");
								hasSwitchOFF = true;
							}
							eSwitch.querySelectorAll('.val')[0].checked = switchValue;
						}
						
						if (
						(!hasSwitchOn && showONOnly)
						|| (!hasSwitchOFF && showOFFOnly)
						|| (eventId != filterSelfSwitches && !eventName.toLowerCase().includes(filterSelfSwitches))
						)
							eEvent.classList.add("hidden");
						else
							eEvent.classList.remove("hidden");
					}
				}
			};
			
			//----------------------------------------------------------------------
			//events view
			
			function initEvents() {
				view.setAttribute('data-view', 'events');
				let mapId = $gameMap.mapId();
				let viewHTML = getViewHeader('events') + getMapHeader(mapId);				
				viewHTML += `
				<div data-mapID="${mapId}" id="content">
					<ul>`;
				if ($gameMap.events().length < 1)
					viewHTML += `
						<p><b>No event was detected.</b></p>`;
				else 
					viewHTML += `
						<p><b>${$gameMap.events().length} event(s) detected :</b>`;
				for (event of $gameMap.events()) {
					let eventId = event.eventId();
					let dataEvent = event.event();
					let eventName = dataEvent.name;
					let activePage = Drag.Debugger.getActivePage(eventId);
					viewHTML += `
						<li data-eventId="${eventId}" class="evData">
							<div class="grid2row">
								${getEventHeader(eventId, eventName)}
								<div>`;
								
					let status = [];
					if (Drag.Debugger.getPagesByTrigger(3, event).length > 0)
						status = Drag.Debugger.checkAutorunEvent(event);
								
					viewHTML += getEventGeneralInfos(event);
					for (let i = 0; i < dataEvent.pages.length; i++)
						viewHTML += `
									<div data-pageId="${i}" class="evPages evPage${i}">
										${getEventElemPageHeader(i, event)}
										<div class="transitionAll025 ${(i === activePage ) ? '' : 'uncollapsed'}">
											${getEventElemOptions(i, event)}
											${getEventElemConditions(i, mapId, event)}
										</div>
										${(status.length > 0 && status[1] === i)? 
										'<div data-warnCode="' + status[0] + '" data-warnPageId="' + status[1] + '" class="warnAutorun">' + getAutorunEventHelp(status) + '</div>'
										: 
										''}
									</div>`;
					viewHTML += `
								</div>
							</div>
						</li>`;
				}
				viewHTML += `
					</ul>
				</div>`;
				view.innerHTML = viewHTML;
			};
			
			function updateEvents() {
				let currentMapId = parseInt(document.getElementById("content").getAttribute("data-mapID"));
				let mapId = $gameMap.mapId();
				if (currentMapId !== mapId) {
					if ($dataMap?.mapId !== currentMapId && $dataMap?.mapId > 0)
						initEvents(view);
				} else {		
					let eEvents = document.querySelectorAll('#content .evData');
					if (!(eEvents?.length > 0))
						return;
					
					let showRunningOnly = document.getElementById('showRunningOnly').checked;
					let showNotRunningOnly = document.getElementById('showNotRunningOnly').checked;
					let showActiveOnly = document.getElementById('showActiveOnly').checked;
					let showNoActiveOnly = document.getElementById('showNoActiveOnly').checked;
					let filterEvents = document.getElementById("filterEvents").value.toLowerCase();
					for (eEvent of eEvents) {
						updateEvent(eEvent, showRunningOnly, showNotRunningOnly, showActiveOnly, showNoActiveOnly, filterEvents);
					}
				}
			};
			
			function updateEvent(eEvent, showRunningOnly = false, showNotRunningOnly = false, showActiveOnly = false, showNoActiveOnly = false, filterEvents = '') {
				let mapId = $gameMap.mapId();
				let eventId = parseInt(eEvent.getAttribute('data-eventId'));
				let gameEvent = $gameMap?.event(eventId);
				let dataEvent = gameEvent?.event();
				if (!dataEvent || !gameEvent)
					return;
				
				let activePage = gameEvent.findProperPageIndex();
				if (activePage !== gameEvent._pageIndex)
					gameEvent.refresh();
				
				let isEventRunning = Drag.Debugger.isEventRunning(eventId);
				let pageRunning = Drag.Debugger.getPageRunning(eventId); 
				
				let evInfo = eEvent.querySelector('.evInfos');
				updateEventGeneralInfos(evInfo, gameEvent, isEventRunning, pageRunning);
				
				let evPages = eEvent.querySelectorAll('.evPages');
				for (evPage of evPages) {
					let pageId = parseInt(evPage.getAttribute('data-pageId'));
					let isPageRunning = pageId === pageRunning;
					
					let evPageHeader = evPage.querySelector('.evPageHeader');
					updateEventElemPageHeader(evPageHeader, gameEvent, isPageRunning, activePage);
				
					let evOptions = evPage.querySelector('.evOptions');
					updateEventElemOptions(evOptions, gameEvent);
					
					let conditions = Drag.Debugger.getEventConditions(dataEvent.pages[pageId], mapId, eventId);
					let evConditions = evPage.querySelector('.evConditions');
					updateEventElemConditions(evConditions, gameEvent, mapId, conditions);
				}
				
				let warnAutorun = eEvent.querySelector('.warnAutorun');						
				if (activePage > -1 && dataEvent.pages[activePage].trigger === 3) {
					let warnCode = parseInt(warnAutorun?.getAttribute('data-warnCode') || -1);
					let warnPageId = parseInt(warnAutorun?.getAttribute('data-warnPageId') || -1);									
					let status = Drag.Debugger.checkAutorunEvent(gameEvent);
					if (status.length > 0 && (warnCode !== status[0] || warnPageId !== status[1])) {
						if (!warnAutorun) {
							warnAutorun = document.createElement('div');
							warnAutorun.classList.add('warnAutorun');
						} else if (status[1] !== warnPageId) {
							warnAutorun.remove();
						}
						warnAutorun.setAttribute('data-warnCode', status[0]);
						warnAutorun.setAttribute('data-warnPageId', status[1]);
						warnAutorun.innerHTML = getAutorunEventHelp(status);
						eEvent.querySelector(`.evPage${status[1]}`).appendChild(warnAutorun);
					} else if (status.length === 0 && warnAutorun) {
						warnAutorun.remove();
					}
				} else if (warnAutorun) {
					warnAutorun.remove();
				}
				
				if (
					(!isEventRunning && showRunningOnly)
					|| (isEventRunning && showNotRunningOnly)
					|| (showActiveOnly && activePage === -1)
					|| (showNoActiveOnly && activePage > -1)
					|| (eventId != filterEvents && !dataEvent.name.toLowerCase().includes(filterEvents))
				)
					eEvent.classList.add("hidden");
				else
					eEvent.classList.remove("hidden");
			};
			
			function getEventGeneralInfos(gameEvent) {
				if (!gameEvent)
					return '';
				let isEventRunning = Drag.Debugger.isEventRunning(gameEvent.eventId());
				let pageRunning = Drag.Debugger.getPageRunning(gameEvent.eventId());
				return `
					<div data-xy="${gameEvent.x},${gameEvent.y}" data-isEventRunning="${isEventRunning}" data-pageRunning="${pageRunning}" class="grid2col rowGap1 mBottom1 evInfos">
						<span>
						${isEventRunning ? 
							'<b>State : </b><br><span class="green bold state">[RUNNING PAGE ' + (pageRunning + 1) + '...]</span>' 
						:   '<b>State : </b><br><span class="red bold state">[NOT RUNNING]</span>'}
							<button data-eventId="${gameEvent.eventId()}" class="button mTop1" type="button" onclick="toggleEvent(this); refreshView();">${isEventRunning ? 'Stop Event' : 'Start Event'}</button>
						</span>
						<span class="textRight">
							<span>
								<b>Position : </b>
							</span>
							<br>
							<span class="fSize20 xy">[x: ${gameEvent.x}, y: ${gameEvent.y}]</span>
							<br>
							<button class="bTpEvent button mTop1" data-xy="${gameEvent.x},${gameEvent.y}" onclick="teleportPlayerTo(this); refreshView();">Teleport To</button>
						</span>
					</div>`;
			};
			
			function updateEventGeneralInfos(elem, gameEvent, isEventRunning, pageRunning) {
				if (!elem || !gameEvent)
					return;
				
				isEventRunning ??= Drag.Debugger.isEventRunning(gameEvent.eventId());
				pageRunning ??= Drag.Debugger.getPageRunning(gameEvent.eventId());
				let currentIsEventRunning = elem.getAttribute("data-isEventRunning") === "true";				
				let currentPageRunning = parseInt(elem.getAttribute("data-pageRunning"));
				
				let state = elem.querySelector('.state');
				if (isEventRunning) {
					if (currentIsEventRunning !== isEventRunning || currentPageRunning !== pageRunning) {
						elem.setAttribute('data-isEventRunning', isEventRunning);
						elem.setAttribute('data-pageRunning', pageRunning);
						state.innerHTML = `[RUNNING PAGE ${(pageRunning + 1)}...]`;
						state.classList.remove('red');
						state.classList.add('green');
						let stateButton = state.nextElementSibling.innerHTML = `Stop Event`;
					}
				} else if (currentIsEventRunning !== isEventRunning) {
					elem.setAttribute('data-isEventRunning', isEventRunning);
					elem.setAttribute('data-pageRunning', pageRunning);
					state.innerHTML = `[NOT RUNNING]`;
					state.classList.remove('green');
					state.classList.add('red');
					let stateButton = state.nextElementSibling.innerHTML = `Start Event`;
				}
				
				let [x, y] = elem.getAttribute("data-xy").split(',').map(Number);
				if (gameEvent.x !== x || gameEvent.y !== y) {
					elem.setAttribute("data-xy", `${gameEvent.x},${gameEvent.y}`);
					let xy = elem.querySelector('.xy');
					xy.innerHTML = `[x: ${gameEvent.x}, y: ${gameEvent.y}]`;
					
					let bTpEvent = elem.querySelector('.bTpEvent');
					bTpEvent.setAttribute('data-xy', `${gameEvent.x},${gameEvent.y}`);
				}
			};
			
			function getEventElemPageHeader(pageId, gameEvent) {
				if (!gameEvent)
					return ``;
				let isPageRunning = Drag.Debugger.isPageRunning(gameEvent.eventId(), pageId);
				let activePage = Drag.Debugger.getActivePage(gameEvent.eventId());
				let isActive = pageId === activePage;
				let page = gameEvent.event().pages[pageId]
				return `
					<div class="evPageHeader">
						<div class="textCenter">
							<hr class="divider2">
							<h4 class="marginAuto pointer">
								<span data-pageId="${pageId}" data-isPageRunning="${isPageRunning}" data-isActive="${isActive}" data-open="${isActive}" onclick="toggleCollapse(this)" class="squareSubTitle">
									${isActive ? 'Hide' : 'Show'} Page ${(pageId + 1)} 
									<span class="state ${isPageRunning ? 'green' : isActive ? '' : 'red'}">[${isPageRunning ? 'RUNNING' : isActive ? 'ACTIVE' : 'INACTIVE'}]</span>
								</span>
							</h4>
						</div>
					</div>`;
			};
			
			function updateEventElemPageHeader(evPageHeader, gameEvent, isPageRunning, activePage) {
				if (!evPageHeader || !gameEvent)
					return;
						
				let pageHeader = evPageHeader.querySelector('.squareSubTitle');
				let pageId = parseInt(pageHeader.getAttribute('data-pageId'));
				
				let currentIsPageRunning = pageHeader.getAttribute('data-isPageRunning') === "true";
				isPageRunning ??= Drag.Debugger.isPageRunning(gameEvent.eventId(), pageId);
				let currentIsActive = pageHeader.getAttribute('data-isActive') === "true";
				activePage ??= Drag.Debugger.getActivePage(gameEvent.eventId());
				let isActive = pageId === activePage;
				
				if ((currentIsPageRunning !== isPageRunning) || (currentIsActive !== isActive)) {
					pageHeader.setAttribute('data-isPageRunning', isPageRunning);
					pageHeader.setAttribute('data-isActive', isActive);
					let state = pageHeader.querySelector('.state');
					if (isPageRunning) {
						state.classList.add("green");
						state.classList.remove("red");
						state.innerHTML = "[RUNNING]";
					} else if (isActive) {
						state.classList.remove("green");
						state.classList.remove("red");
						state.innerHTML = "[ACTIVE]";
					} else {
						state.classList.add("red");
						state.classList.remove("green");
						state.innerHTML = "[INACTIVE]";
					}
				}
			};
			
			function getEventElemOptions(pageId, gameEvent) {
				let eventId = gameEvent.eventId();
				let dataEvent = gameEvent.event();
				let trigger = dataEvent.pages[pageId].trigger;
				let priorityType = dataEvent.pages[pageId].priorityType;
				let walking = dataEvent.pages[pageId].walkAnime === true ? "checked" : "";
				let stepping = dataEvent.pages[pageId].stepAnime === true ? "checked" : "";
				let directionFix = dataEvent.pages[pageId].directionFix === true ? "checked" : "";
				let through = dataEvent.pages[pageId].through === true ? "checked" : "";
				return `
					<div class="grid2col rowGap1 mBottom1 mTop1 evOptions">
						<div>
							<label for="standard-select"><b>Trigger :</b></label>
							<div class="select">
								<select data-eventId="${eventId}" data-pageId="${pageId}" onchange="setEventTrigger(this); refreshView();" id="standard-select" class="trigger">
									<option value="0" ${trigger === 0 ? 'selected="selected"' : ''}>Action Button</option>
									<option value="1" ${trigger === 1 ? 'selected="selected"' : ''}>Player Touch</option>
									<option value="2" ${trigger === 2 ? 'selected="selected"' : ''}>Event Touch</option>
									<option value="3" ${trigger === 3 ? 'selected="selected"' : ''}>Autorun</option>
									<option value="4" ${trigger === 4 ? 'selected="selected"' : ''}>Parallel</option>
								</select>
								<span class="focus"></span>
							</div>
						</div>
						<div class="textRight">
							<label for="standard-select"><b>Priority Type :</b></label>
							<div class="select">
								<select data-eventId="${eventId}" data-pageId="${pageId}" onchange="setEventPriorityType(this); refreshView();" id="standard-select" class="priorityType">
									<option value="0" ${priorityType === 0 ? 'selected="selected"' : ''}>Below characters</option>
									<option value="1" ${priorityType === 1 ? 'selected="selected"' : ''}>Same as characters</option>
									<option value="2" ${priorityType === 2 ? 'selected="selected"' : ''}>Above characters</option>
								</select>
								<span class="focus"></span>
							</div>
						</div>
						<div>
							<label class="form-control">
								<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="setEventWalkAnime(this); refreshView();" type="checkbox" class="walking" name="walking" ${walking}>
								Walking
							</label>
							<label class="form-control">
								<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="setEventStepAnime(this); refreshView();" type="checkbox" class="stepping" name="stepping" ${stepping}>
								Stepping
							</label>
							<label class="form-control">
								<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="setEventDirectionFix(this); refreshView();" type="checkbox" class="directionFix" name="directionFix" ${directionFix}>
								Direction Fix
							</label>
							<label class="form-control">
								<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="setEventThrough(this); refreshView();" type="checkbox" class="through" name="through" ${through}>
								Through
							</label>
						</div>
					</div>`;
			};
			
			function updateEventElemOptions(elem, gameEvent) {
				let dataEvent = gameEvent.event();
				if (!elem || !dataEvent)
					return;
				
				let triggerElem = elem.querySelector('.trigger');
				let pageId = parseInt(triggerElem.getAttribute('data-pageId'));
				
				let page = dataEvent.pages[pageId];
				if (!page)
					return;
				
				let currentTrigger = parseInt(triggerElem.value);
				let trigger = page.trigger;
				if (currentTrigger !== trigger)
					triggerElem.value = trigger;
				
				let priorityTypeElem = elem.querySelector('.priorityType');
				let currentPriorityType = parseInt(priorityTypeElem.value);
				let priorityType = page.priorityType;
				if (currentPriorityType !== priorityType)
					priorityTypeElem.value = priorityType;
				
				let walkingElem = elem.querySelector('.walking');
				let currentWalking = walkingElem.checked;
				let walkAnime = page.walkAnime;
				if (currentWalking !== walkAnime)
					walkingElem.checked = walkAnime;
				
				let steppingElem = elem.querySelector('.stepping');
				let currentStepping = steppingElem.checked;
				let stepAnime = page.stepAnime;
				if (currentStepping !== stepAnime)
					steppingElem.checked = stepAnime;
				
				let directionFixElem = elem.querySelector('.directionFix');
				let currentDirectionFix = directionFixElem.checked;
				let directionFix = page.directionFix;
				if (currentDirectionFix !== directionFix)
					directionFixElem.checked = directionFix;
				
				let throughElem = elem.querySelector('.through');
				let currentThrough = throughElem.checked;
				let through = page.through;
				if (currentThrough !== through)
					throughElem.checked = through;
			};
			
			function getEventElemPages(currentPage, nbPage) {
				let html = `
					<div class="textRight">
						<label for="standard-select"><b>Show Page</b></label>
						<br>
						<div class="select fRight w25">
							<select id="standard-select">
							<option ${currentPage === -1 ? 'selected="selected"' : ''} value="-1"></option>`;
				for (let i = 0; i < nbPage; i++)
					html += `<option value="${i}" ${i === currentPage ? 'selected="selected"' : ''}>${i + 1}</option>`;
				html += `
							</select>
							<span class="focus"></span>
						</div>
					</div>`;
				return html;
			};
			
			function onSwitchFilterConditionFocus(elem) {
				let select = elem.parentNode.querySelector('.selectFiltered');
				if (!select)
					return;
				select.length = 0;
				for ([switchId, switchName] of $dataSystem.switches.entries()) {
					if (switchId === 0 || !(switchId === parseInt(elem.value) || switchName.toLowerCase().includes(elem.value.toString().toLowerCase())))
						continue;
					let switchValue = $gameSwitches.value(switchId);
					let opt = document.createElement("option");
					opt.value = switchId;
					opt.text = `[${switchId}] ${switchName}`;
					if (switchValue) {
						opt.classList.add("bgGreen");
						opt.classList.remove("bgRed");
					} else {
						opt.classList.add("bgRed");
						opt.classList.remove("bgGreen");
					}
					opt.classList.add('selectFilteredOption');
					select.add(opt);
				}
				setupSelectFiltered(elem, select);
			};
			
			function onVariableFilterConditionFocus(elem) {
				let select = elem.parentNode.querySelector('.selectFiltered');
				if (!select)
					return;
				select.length = 0;
				for ([varId, varName] of $dataSystem.variables.entries()) {
					if (varId === 0 || !(varId === parseInt(elem.value) || varName.toLowerCase().includes(elem.value.toString().toLowerCase())))
						continue;
					let eventId = elem.getAttribute('data-eventId');
					let pageId = elem.getAttribute('data-pageId');					
					let isGreater = $gameVariables.value(varId) >= $dataMap.events[eventId].pages[pageId].conditions.variableValue;
					let varValue = $gameVariables.value(varId);
					let opt = document.createElement("option");
					opt.value = varId;
					opt.text = `[${varId}] ${varName} (${varValue})`;
					if (isGreater) {
						opt.classList.add("bgGreen");
						opt.classList.remove("bgRed");
					} else {
						opt.classList.add("bgRed");
						opt.classList.remove("bgGreen");
					}
					opt.classList.add('selectFilteredOption');
					select.add(opt);
				}
				setupSelectFiltered(elem, select);
			};
			
			function onItemFilterConditionFocus(elem) {
				let select = elem.parentNode.querySelector('.selectFiltered');
				if (!select)
					return;
				select.length = 0;
				for (item of $dataItems) {
					if (!item || !(item.id === parseInt(elem.value) || item.name.toLowerCase().includes(elem.value.toString().toLowerCase())))
						continue;
					let hasItem = $gameParty.hasItem(item);
					let opt = document.createElement("option");
					opt.value = item.id;
					opt.text = `[${item.id}] ${item.name}`;
					if (hasItem) {
						opt.classList.add("bgGreen");
						opt.classList.remove("bgRed");
					} else {
						opt.classList.add("bgRed");
						opt.classList.remove("bgGreen");
					}
					opt.classList.add('selectFilteredOption');
					select.add(opt);
				}
				setupSelectFiltered(elem, select);
			};
			
			function onActorFilterConditionFocus(elem) {
				let select = elem.parentNode.querySelector('.selectFiltered');
				if (!select)
					return;
				select.length = 0;
				for (actor of $dataActors) {
					if (!actor || !(actor.id === parseInt(elem.value) || actor.name.toLowerCase().includes(elem.value.toString().toLowerCase())))
						continue;
					let hasActor = $gameParty.members().contains($gameActors.actor(actor.id));
					let opt = document.createElement("option");
					opt.value = actor.id;
					opt.text = `[${actor.id}] ${actor.name}`;
					if (hasActor) {
						opt.classList.add("bgGreen");
						opt.classList.remove("bgRed");
					} else {
						opt.classList.add("bgRed");
						opt.classList.remove("bgGreen");
					}
					opt.classList.add('selectFilteredOption');
					select.add(opt);
				}
				setupSelectFiltered(elem, select);
			};
			
			function onCommonEventFilterConditionFocus(elem) {
				let select = elem.parentNode.querySelector('.selectFiltered');
				if (!select)
					return;
				select.length = 0;
				for ([commonEventId, commonEvent] of $dataCommonEvents.entries()) {
					if (commonEventId === 0 || !(commonEventId === parseInt(elem.value) || commonEvent.name.toLowerCase().includes(elem.value.toString().toLowerCase())))
						continue;
					let opt = document.createElement("option");
					opt.value = commonEventId;
					opt.text = `[${commonEventId}] ${commonEvent.name}`;
					opt.classList.add('selectFilteredOption');
					select.add(opt);
				}
				setupSelectFiltered(elem, select);
			};
			
			function setupSelectFiltered(elem, select) {
				if (select.length > 0) {
					select.style.display = "list-item";
					select.disabled = false;
					select.size = select.length >= 5 ? 5 : select.length === 1 ? select.length + 1 : select.length;
					let height = select.length > 1 ? (select.size * 25) + 2 : ((select.size - 1) * 25) + 2;
					select.style.height = `${height}px`;
					select.selectedIndex = 0;
					
					elem.onkeyup = listenForArrows.bind(select);
				} else {
					select.style.display = "none";
				}
			}
			
			function listenForArrows(e) {
				let selectedIndex = this.selectedIndex;
				if (e.code === "ArrowDown" || e.code === "ArrowRight") {
					if (e.code === "ArrowDown")
						this.selectedIndex++;
					if (e.code === "ArrowRight")
						this.selectedIndex += 10;
					if (this.selectedIndex < 0)
						this.selectedIndex = 0;
					setValueInputFilterConditions(this, true);
				}
				if (e.code === "ArrowUp" || e.code === "ArrowLeft") {
					if (e.code === "ArrowUp")
						this.selectedIndex--;
					if (e.code === "ArrowLeft")
						this.selectedIndex -= 10;
					if (this.selectedIndex < 0)
						this.selectedIndex = this.options.length - 1;
					setValueInputFilterConditions(this, true);
				}
				if (e.code === "Enter") {
					setValueInputFilterConditions(this);
				}
			}
			
			function onInputFilterConditionFocusOut(elem) {
				let select = elem.parentNode.querySelector('.selectFiltered');
				if (!select)
					return;
				setTimeout(() => {
					if (document.activeElement !== select) {
						select.length = 0;
						select.style.display = "none";
					}
				}, 1);
				elem.onkeyup = null;
			};
			
			function onSelectFilteredConditionSelectFocusOut(elem) {
				setTimeout(() => {
					let input = elem.parentNode.querySelector('.inputFilter');
					if (document.activeElement !== input) {
						elem.length = 0;
						elem.style.display = "none";
					}
				}, 1);
			}
			
			function setValueInputFilterConditions(select, keepOpened = false) {
				let input = select.parentNode.querySelector('.inputFilter');
				if (!input)
					return;
				input.value = !isNaN(parseInt(select.value)) ? parseInt(select.value) : 0;
				if (!keepOpened) {
					select.length = 0;
					select.style.display = "none";
					input.onkeyup = null;
				}
				input.onchange();
			};
			
			function verifyInputFilterConditionValue(elem) {
				if (isNaN(elem.value) || elem.value.trim() === "")
					elem.value = 0;
			};
			
			function updateSelfSwitchConditionOptionsColours(elem) {
				let eventId = elem.getAttribute("data-eventId");
				for (option of elem.options) {
					let letter = option.value;
					let val = $gameSelfSwitches.value(`${$gameMap.mapId()},${eventId},${letter}`);
					option.style.fontWeight = "bold";
					option.style.color = "white";
					if (val) {
						option.classList.add("bgGreen");
					} else {
						option.classList.add("bgRed");
					}
				}
			};
			
			function updateDataAfter(elem) {
				let elemId = elem.getAttribute('id');
				switch (elemId) {
					case 'switch1Id':
					case 'switch2Id':
					case 'switchFilter':
						elem.parentNode.setAttribute('data-after', `${$gameSwitches.getName(elem.value)}`);
						break;
					case 'var1Id':
					case 'varFilter':
					case '122var':
						elem.parentNode.setAttribute('data-after', `${$gameVariables.getName(elem.value)} (${$gameVariables.value(elem.value)})`);
						break;
					case 'item1Id':
						elem.parentNode.setAttribute('data-after', `${$dataItems[elem.value].name}`);
						break;
					case 'actor1Id':
						elem.parentNode.setAttribute('data-after', `${$dataActors[elem.value].name}`);
						break;
					case 'CEFilter':
						elem.parentNode.setAttribute('data-after', `${$dataCommonEvents[elem.value].name}`);
						break;
					default:
						elem.parentNode.setAttribute('data-after', ``);
						break;
				}
			}			
			
			function getEventElemConditions(pageId, mapId, gameEvent) {
				let eventId = gameEvent.eventId();
				let dataEvent = gameEvent.event();
				let page = dataEvent.pages[pageId];
				
				let conditions = Drag.Debugger.getEventConditions(page, mapId, eventId);
				if (!conditions)
					return ``;
				
				return `
					<div data-eventId="${eventId}" data-pageId="${pageId}" class="grid2col rowGap1 mBottom1 mTop1 evConditions">
						<label class="form-control">
							<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="toggleEventSwitch1(this); refreshView();" 
								type="checkbox" class="alignSelfCenter" id="switch1" name="switch1" ${conditions[0].valid ? 'checked' : ''}
							/>
							<div class="grid2col gridTemColMin2 gridTemRowMinMax gridColGap relative">
								<span class="alignSelfCenter">Switch</span>
								<div class="wrapInputFilter ${conditions[0].valid ? '' : 'disabled'}" data-after="${$gameSwitches.getName(conditions[0].conditionId)}">
									<input data-eventId="${eventId}" data-pageId="${pageId}" 
										oninput="onSwitchFilterConditionFocus(this);" onfocus="this.oninput();" 
										onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventSwitch1Id(this); refreshView();" 
										type="text" class="inputFilter ${conditions[0].valid ? conditions[0].conditionCheck ? 'borderForestGreen2' : 'borderIndianRed2' : 'disabled'}" id="switch1Id" name="switch1Id" 
										value="${conditions[0].valid ? conditions[0].conditionId : ''}" placeholder="0" ${conditions[0].valid ? '' : 'disabled'}
									/>
									<select onfocusout="onSelectFilteredConditionSelectFocusOut(this);" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
										class="selectFiltered" disabled>
									</select>
								</div>
							</div>
						</label>
						<label class="form-control-right">
							<div class="grid2col gridTemCol2Max gridTemRowMaxMin gridColGap relative">
								<div class="wrapInputFilterRight ${conditions[1].valid ? '' : 'disabled'}" data-after="${$gameSwitches.getName(conditions[1].conditionId)}">
									<input data-eventId="${eventId}" data-pageId="${pageId}" 
										oninput="onSwitchFilterConditionFocus(this);" onfocus="this.oninput();" 
										onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventSwitch2Id(this); refreshView();" 
										type="text" class="inputFilter ${conditions[1].valid ? conditions[1].conditionCheck ? 'borderForestGreen2' : 'borderIndianRed2' : 'disabled'}" id="switch2Id" name="switch2Id"
										value="${conditions[1].valid ? conditions[1].conditionId : ''}" placeholder="0" ${conditions[1].valid ? '' : 'disabled'}
									/>
									<select onfocusout="onSelectFilteredConditionSelectFocusOut(this)" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
										class="selectFiltered" disabled>
									</select>
								</div>
								<span class="alignSelfCenter">Switch</span>
							</div>
							<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="toggleEventSwitch2(this); refreshView();" 
								type="checkbox" class="alignSelfCenter" id="switch2" name="switch2" ${conditions[1].valid ? 'checked' : ''}
							/>
						</label>
						<label class="form-control">
							<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="toggleEventVariable1(this); refreshView();" 
								type="checkbox" class="alignSelfCenter" id="var1" name="var1" ${conditions[2].valid ? 'checked' : ''}
							/>
							<div class="grid2col gridTemColMin2 gridTemRowMinMax gridColGap gridRowGap5 relative">
								<span class="alignSelfCenter">Variable</span>
								<div class="wrapInputFilter ${conditions[0].valid ? '' : 'disabled'}" data-after="${$gameVariables.getName(conditions[2].conditionId)} (${$gameVariables.value(conditions[2].conditionId)})">
									<input data-eventId="${eventId}" data-pageId="${pageId}" 
										oninput="onVariableFilterConditionFocus(this);" onfocus="this.oninput();" 
										onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventVariable1Id(this); refreshView();"										
										type="text" class="inputFilter ${conditions[2].valid ? conditions[2].conditionCheck ? 'borderForestGreen2' : 'borderIndianRed2' : 'disabled'}" id="var1Id" name="var1Id" 
										value="${conditions[2].valid ? conditions[2].conditionId : ''}" placeholder="0" ${conditions[2].valid ? '' : 'disabled'}
									/>
									<select onfocusout="onSelectFilteredConditionSelectFocusOut(this)" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
										class="selectFiltered" disabled>
									</select>
								</div>
								<span class="alignSelfCenter textCenter">>=</span>
								<input data-eventId="${eventId}" data-pageId="${pageId}"
									oninput="this.onchange();" onchange="verifyInputFilterConditionValue(this); changeEventVariable1Value(this); refreshView();"
									type="number"  class="${conditions[2].valid ? conditions[2].conditionCheck ? 'borderForestGreen2' : 'borderIndianRed2' : 'disabled'}" id="var1Value" name="var1Value"
									value="${conditions[2].valid ? conditions[2].value : ''}" placeholder="0" ${conditions[2].valid ? '' : 'disabled'}
								/>
							</div>
						</label>
						<label class="form-control-right">
							<div class="grid2col gridTemCol2Max gridTemRowMaxMin gridColGap alignSelfCenter">
								<div class="select ${conditions[3].valid ? conditions[3].conditionCheck ? 'borderForestGreen2' : 'borderIndianRed2' : 'disabled disabled'}">
									<select data-eventId="${eventId}" data-pageId="${pageId}" data-eventId="${eventId}"
										onfocus="updateSelfSwitchConditionOptionsColours(this);" onchange="changeEventSelfSwitch1Id(this); refreshView();" 
										id="selfSwitch1Id" ${conditions[3].valid ? '' : 'disabled'}
									>
										<option hidden disabled ${conditions[3].valid ? '' : 'selected'} value></option>
										<option value="A" ${conditions[3].valid ? conditions[3].conditionId === "A" ? 'selected="selected"' : '' : ''}>A</option>
										<option value="B" ${conditions[3].valid ? conditions[3].conditionId === "B" ? 'selected="selected"' : '' : ''}>B</option>
										<option value="C" ${conditions[3].valid ? conditions[3].conditionId === "C" ? 'selected="selected"' : '' : ''}>C</option>
										<option value="D" ${conditions[3].valid ? conditions[3].conditionId === "D" ? 'selected="selected"' : '' : ''}>D</option>
									</select>
									<span class="focus"></span>
								</div>
								<label for="standard-select" class="alignSelfCenter"><b>Self Switch</b></label>
							</div>
							<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="toggleEventSelfSwitch1(this); refreshView();" 
								type="checkbox" class="alignSelfCenter" id="selfSwitch1" name="selfSwitch1" ${conditions[3].valid ? 'checked' : ''}
							/>
						</label>
						<label class="form-control">
							<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="toggleEventItem1(this); refreshView();" 
								type="checkbox" class="alignSelfCenter" id="item1" name="item1" ${conditions[4].valid ? 'checked' : ''}
							/>
							<div class="grid2col gridTemColMin2 gridTemRowMinMax gridColGap relative">
								<span class="alignSelfCenter">Item</span>
								<div class="wrapInputFilter ${conditions[0].valid ? '' : 'disabled'}" data-after="${$dataItems[conditions[4].conditionId].name}">
									<input data-eventId="${eventId}" data-pageId="${pageId}" 
										oninput="onItemFilterConditionFocus(this);" onfocus="this.oninput();" 
										onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventItem1Id(this); refreshView();"	
										type="text" class="inputFilter ${conditions[4].valid ? conditions[4].conditionCheck ? 'borderForestGreen2' : 'borderIndianRed2' : 'disabled'}" id="item1Id" name="item1Id" 
										value="${conditions[4].valid ? conditions[4].conditionId : ''}" placeholder="0" ${conditions[4].valid ? '' : 'disabled'}
									/>
									<select onfocusout="onSelectFilteredConditionSelectFocusOut(this)" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
										class="selectFiltered" disabled>
									</select>
								</div>
							</div>
						</label>
						<label class="form-control-right">
							<div class="grid2col gridTemCol2Max gridTemRowMaxMin gridColGap relative">
								<div class="wrapInputFilterRight ${conditions[0].valid ? '' : 'disabled'}" data-after="${$dataActors[conditions[5].conditionId].name}">
									<input data-eventId="${eventId}" data-pageId="${pageId}" 
										oninput="onActorFilterConditionFocus(this);" onfocus="this.oninput();" 
										onfocusout="onInputFilterConditionFocusOut(this)" onchange="verifyInputFilterConditionValue(this); updateDataAfter(this); changeEventActor1Id(this); refreshView();"	
										type="text" class="inputFilter ${conditions[5].valid ? conditions[5].conditionCheck ? 'borderForestGreen2' : 'borderIndianRed2' : 'disabled'}" id="actor1Id" name="actor1Id" 
										value="${conditions[5].valid ? conditions[5].conditionId : ''}" placeholder="0" ${conditions[5].valid ? '' : 'disabled'}>
									<select onfocusout="onSelectFilteredConditionSelectFocusOut(this)" onchange="setValueInputFilterConditions(this);" onclick="this.onchange(); return false;"
										class="selectFiltered" disabled>
									</select>
								</div>
								<span class="alignSelfCenter">Actor</span>
							</div>
							<input data-eventId="${eventId}" data-pageId="${pageId}" onchange="toggleEventActor1(this); refreshView();" 
								type="checkbox" class="alignSelfCenter" id="actor1" name="actor1" ${conditions[5].valid ? 'checked' : ''}
							/>
						</label>
					</div>`;
			};
			
			function updateEventElemConditions(elem, gameEvent, mapId, conditions) {
				if (!elem || !gameEvent)
					return;
				let eventId = elem.getAttribute('data-eventId');
				let pageId = elem.getAttribute('data-pageId');
				let dataEvent = gameEvent.event();
				let page = dataEvent.pages[pageId];
				conditions ??= Drag.Debugger.getEventConditions(page, mapId, eventId);
				if (!conditions)
					return;
				let checkboxs = elem.querySelectorAll('input[type="checkbox"]');
				
				for ([i, checkbox] of checkboxs.entries()) {
					let id = checkbox.getAttribute('id');
					let inputLinked = checkbox.parentNode.querySelector(`#${id}Id`);
					if (checkbox.checked !== conditions[i].valid)
						checkbox.checked = conditions[i].valid;
					
					if (inputLinked.disabled !== !checkbox.checked)
						inputLinked.disabled = !checkbox.checked;
					
					let currentVal = parseInt(inputLinked.value);
					if (currentVal !== conditions[i].conditionId)
						inputLinked.value = conditions[i].conditionId;
					
					if (id === "var1") {
						var varValInput = checkbox.parentNode.querySelector(`#var1Value`);
						if (varValInput.disabled !== !checkbox.checked)
							varValInput.disabled = !checkbox.checked;
						
						let currentVarVal = parseInt(varValInput.value);
						if (currentVarVal !== conditions[i].value)
							varValInput.value = conditions[i].value;
					}
					
					let borderElem = inputLinked.nodeName === 'SELECT' ? inputLinked.parentNode : inputLinked;
					if (conditions[i].conditionCheck && conditions[i].valid) {
						inputLinked.parentNode.classList.remove("disabled");
						borderElem.classList.add("borderForestGreen2");
						borderElem.classList.remove("borderIndianRed2");
						borderElem.classList.remove("disabled");
						if (id === "var1") {
							varValInput.classList.add("borderForestGreen2");
							varValInput.classList.remove("borderIndianRed2");
							varValInput.classList.remove("disabled");
						}
					} else if (conditions[i].valid) {
						inputLinked.parentNode.classList.remove("disabled");
						borderElem.classList.add("borderIndianRed2");
						borderElem.classList.remove("borderForestGreen2");
						borderElem.classList.remove("disabled");
						if (id === "var1") {
							varValInput.classList.add("borderIndianRed2");
							varValInput.classList.remove("borderForestGreen2");
							varValInput.classList.remove("disabled");
						}
					} else {
						inputLinked.parentNode.classList.add("disabled");
						borderElem.classList.add("disabled");
						borderElem.classList.remove("borderForestGreen2");
						borderElem.classList.remove("borderIndianRed2");
						if (id === "var1") {
							varValInput.classList.add("disabled");
							varValInput.classList.remove("borderForestGreen2");
							varValInput.classList.remove("borderIndianRed2");
						}
					}
				}
			};			
			
			function getAutorunEventHelp(status) {
				let [code, pageId, conditions, higherPagesConditions] = status;
				pageId++;
				let helpStuck = `<u onclick="showHelpAutoEvStuck(this)" class="pointer">It's stuck. How can I fix that ?</u>`;
				switch (code) {
					case 1:
						output = `<p class="red bold textCenter margin0">WARNING AUTORUN: page ${pageId} is active, has no defined conditions and there are no pages higher than it, so it is currently impossible to shut off.</p>`;
						return output;
						break;
					case 2:
						output = `
							<p class="red bold textCenter margin0">WARNING AUTORUN: page ${pageId} is active and there are no pages higher than it. ${helpStuck}</p>
							<div class="uncollapsed helpAutoEvStuck">
								<div>
									In order to shut it off, you may have to <b>create a higher page</b> OR <b>turn off/no longer meet one of its conditions as shown below</b> :
									<ul class="helpList">
										<br>`;
						for (condition of conditions)
							if (condition.valid)
								output += `
										<li>
											<i>${condition.outputOFF}</i>
										</li>`;
						output += `
									</ul>
									<span class="closeHelpAutoEvStuck" onclick="hideHelpAutoEvStuck(this)"></span>
								</div>
							</div>`;
						return output;
						break;
					case 3:
						output = `
							<p class="red bold textCenter margin0">WARNING AUTORUN: page ${pageId} is active and has no defined conditions. ${helpStuck}</p>
							<div class="uncollapsed helpAutoEvStuck">
								<div>
									In order to shut it off, you may have to <b>define some conditions</b> OR <b>turn on a higher page by meeting the following conditions</b> :
									<ul class="helpList">`;
						for (higherPagesCondition of higherPagesConditions) {
							output += `
										<br>
										<span><b>Page ${higherPagesCondition[0] + 1} :</b></span>`;
							for (condition of higherPagesCondition[1])
								if (condition.valid)
									output += ` 
										<li>
											<i>${condition.outputON}</i>
										</li>`;
						}
						output += `
									</ul>
									<span class="closeHelpAutoEvStuck" onclick="hideHelpAutoEvStuck(this)"></span>
								</div>
							</div>`;
						return output;
						break;	
					case 4:
						output = `
							<p class="red bold textCenter margin0">WARNING AUTORUN: page ${pageId} is active. ${helpStuck}</p>
							<div class="uncollapsed helpAutoEvStuck">
								<div>
									In order to shut it off, you may have <b>to turn off/no longer meet one of its conditions as shown below</b> :
									<ul class="helpList">
										<br>`;
						for (condition of conditions)
							if (condition.valid)
								output += `
										<li>
											<i>${condition.outputOFF}</i>
										</li>`;
						output += `
									</ul>
									<br>
									<span>OR <b>turn on a higher page by meeting the following conditions</b> :</span>
									<ul class="helpList">`;
						for (higherPagesCondition of higherPagesConditions) {
							output += `
										<br>
										<span><b>Page ${higherPagesCondition[0] + 1} :</b></span>`;
							for (condition of higherPagesCondition[1])
								if (condition.valid)
									output += ` 
										<li>
											<i>${condition.outputON}</i>
										</li>`;
						}
						output += `
									</ul>
									<span class="closeHelpAutoEvStuck" onclick="hideHelpAutoEvStuck(this)"></span>
								</div>
							</div>`;
						return output;
						break;
					default:
						return '';
						break;
				}
			};
			
			function toggleEvent(elem) {
				let eventId = parseInt(elem.getAttribute('data-eventId'));
				let isEventRunning = Drag.Debugger.isEventRunning(eventId);
				if (isEventRunning)
					$gameMap.event(eventId).stop();
				else if($gameMap?.event(eventId)?.page())
					$gameMap.event(eventId).start();
			};
			
			function teleportPlayerTo(elem) {
				let xy = elem.getAttribute('data-xy');
				let [x, y] = xy.split(',').map(Number);
				$gamePlayer.reserveTransfer($gameMap.mapId(), x, y, $gamePlayer.direction(), 2);
				mainWindow.SceneManager.getCurrentScene().update();
			};
			
			function toggleCollapse(elem) {
				if (!elem)
					return;
				let open = !(elem.getAttribute("data-open") === "true");
				elem.setAttribute("data-open", open);
				if (!open) {
					elem.innerHTML = elem.innerHTML.replace("Hide", "Show");
					elem.parentNode.parentNode.parentNode.nextElementSibling.classList.add("uncollapsed");
				} else {
					elem.innerHTML = elem.innerHTML.replace("Show", "Hide");
					elem.parentNode.parentNode.parentNode.nextElementSibling.classList.remove("uncollapsed");
				}
			};
			
			//-----------------------------------------------------------------
			// accessors
			
			function setEventTrigger(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = parseInt(elem.value);
				window.opener.Drag.Debugger.setEventTrigger(eventId, pageId, val);
			};
			
			function setEventPriorityType(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = parseInt(elem.value);
				window.opener.Drag.Debugger.setEventPriorityType(eventId, pageId, val);
			};
			
			function setEventWalkAnime(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.setEventWalkAnime(eventId, pageId, val);
			};
			
			function setEventStepAnime(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.setEventStepAnime(eventId, pageId, val);
			};
			
			function setEventDirectionFix(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.setEventDirectionFix(eventId, pageId, val);
			};
			
			function setEventThrough(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.setEventThrough(eventId, pageId, val);
			};
			
			function toggleEventSwitch1(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.toggleEventSwitch1(eventId, pageId, val);
			}; 
			
			function toggleEventSwitch2(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.toggleEventSwitch2(eventId, pageId, val);
			};
			
			function toggleEventVariable1(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.toggleEventVariable1(eventId, pageId, val);
			};
			
			function toggleEventSelfSwitch1(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.toggleEventSelfSwitch1(eventId, pageId, val);
			};
			
			function toggleEventItem1(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.toggleEventItem1(eventId, pageId, val);
			};
			
			function toggleEventActor1(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.checked;
				window.opener.Drag.Debugger.toggleEventActor1(eventId, pageId, val);
			};
			
			function changeEventSwitch1Id(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = parseInt(elem.value);
				window.opener.Drag.Debugger.changeEventSwitch1Id(eventId, pageId, val);
			}; 			
			
			function changeEventSwitch2Id(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = parseInt(elem.value);
				window.opener.Drag.Debugger.changeEventSwitch2Id(eventId, pageId, val); 
			}; 
			
			function changeEventVariable1Id(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = parseInt(elem.value);
				window.opener.Drag.Debugger.changeEventVariable1Id(eventId, pageId, val);
			}; 
			
			function changeEventVariable1Value(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = parseInt(elem.value);
				window.opener.Drag.Debugger.changeEventVariable1Value(eventId, pageId, val);
			};
			
			function changeEventSelfSwitch1Id(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = elem.value;
				window.opener.Drag.Debugger.changeEventSelfSwitch1Id(eventId, pageId, val);
			}; 
			
			function changeEventItem1Id(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = parseInt(elem.value);
				window.opener.Drag.Debugger.changeEventItem1Id(eventId, pageId, val);
			}; 
			
			function changeEventActor1Id(elem) {
				let eventId = parseInt(elem.getAttribute("data-eventId"));
				let pageId = parseInt(elem.getAttribute("data-pageId"));
				let val = parseInt(elem.value);
				window.opener.Drag.Debugger.changeEventActor1Id(eventId, pageId, val);
			}; 
			
			function triggerChildEvent(elem, selector, attrName) {
				for (radio of elem.querySelectorAll(selector)) {
					let func = new Function('e', `with(document) { with(this) { ${radio.getAttribute(attrName)} } }`);
					func.call(radio, {});
				}
			};
			
			function toggleLinkedInput(elem, id) {
				let linkedInput;
				let parent = elem.parentNode;
				while (!linkedInput) {
					if (!parent)
						return;
					linkedInput = parent.querySelector(`[id='${id}']`);
					parent = parent?.parentNode;
				}
				linkedInput.disabled = !elem.checked;
			};
			
			function showHelpAutoEvStuck(elem) {
				elem.parentNode.nextElementSibling.classList.remove("uncollapsed");
				document.documentElement.style.top = (-(document.documentElement.scrollTop) + 'px');
				document.documentElement.classList.add("noscroll");
				// elem.parentNode.nextSibling.style.opacity = 255;
			};
			
			function hideHelpAutoEvStuck(elem) {
				elem.parentNode.parentNode.classList.add("uncollapsed");
				let scrolltop = (-(parseInt(document.documentElement.style.top)));
				document.documentElement.classList.remove("noscroll");
				window.scrollTo(0, scrolltop);
			};
			
			function getTriggerType(trigger) {
				switch (trigger) {
					case 0:
						trigger = "Action Button";
						break;
					case 1:
						trigger = "Player Touch";
						break;
					case 2: 
						trigger = "Event Touch";
						break;
					case 3:
						trigger = "Autorun";
						break;
					case 4: 
						trigger = "Parralel";
						break;
					default:
						trigger = "Action Button";
				}
				return trigger;
			};
			
			function getPriorityType(priorityType) {
				switch (priorityType) {
					case 0:
						priorityType = "Below characters";
						break;
					case 1:
						priorityType = "Same as characters";
						break;
					case 2: 
						priorityType = "Above characters";
						break;
				}
				return priorityType;
			};
			
			function uncheckElem(elemID) {
				document.getElementById(elemID).checked = false;
			};
			
			function setVariable(varId, value = 0) {
				if (!switchId)
					return;
				let mainWindow = window.opener;
				value = !isNaN(Number(value)) ? Number(value) : value;
				mainWindow.$gameVariables.setValue(varId, value);
			};
			
			function toggleSelfSwitch(switchId) {
				if (!switchId)
					return;
				let mainWindow = window.opener;
				mainWindow.$gameSelfSwitches.setValue(switchId, !mainWindow.$gameSelfSwitches.value(switchId));
				refreshView();
			};
			
			function showTooltip() {
				let elem = document.querySelectorAll(".info")[0];
				if (!elem)
					return;
				elem.classList.remove("invisible");
				elem.style.opacity = 255;
			};
			
			function hideTooltip() {
				let elem = document.querySelectorAll(".info")[0];
				if (!elem)
					return;
				elem.classList.add("invisible");
				elem.style.opacity = 0;
			}
			
			function updateLayers(layer, displayed) {
				if (displayed)
					window.opener.Drag.SandboxMap.showLayer(layer);
				else
					window.opener.Drag.SandboxMap.hideLayer(layer);
			};
			
			function clearTileset() {
				for (child of app.stage.children)
					child.destroy();
				app.stage.children = [];
			};
			
			function onSpriteMouseOver(mouseData, sprite) {
				showSpriteBorders(mouseData, sprite.x, sprite.y);
				showTilesetTileId(mouseData, sprite.x, sprite.y, sprite.tilesetTileId);
			};
			
			function showSpriteBorders(mouseData, x, y) {
				let borders = document.getElementById("spriteBorders");
				borders.style.left = (x + app.view.offsetLeft) + 'px';
				borders.style.top = (y + app.view.offsetTop) + 'px';
				borders.style.visibility = "visible";
				borders.style.opacity = 1;
			};
			
			function showTilesetTileId(mouseData, x, y, id) {
				let popup = document.getElementById("tilesetTileId");
				x += 48 + app.view.offsetLeft;
				if (x + popup.offsetWidth <= window.innerWidth - 20)
					popup.style.left = x + 'px';
				else
					popup.style.left = (x - popup.offsetWidth - 20) + 'px';
				y += 48 + app.view.offsetTop;
				if (y + popup.offsetHeight <= window.innerHeight - 20)
					popup.style.top = y + 'px';
				else 
					popup.style.top = (y - popup.offsetHeight - 48) + 'px';
				popup.style.visibility = "visible";
				popup.style.opacity = 1;
				popup.innerHTML = "Tile ID :    " + id;
			};
			
			function hideTilesetTileId(mouseData) {
				<!-- let popup = document.getElementById("tilesetTileId"); -->
				<!-- popup.style.visibility = "hidden"; -->
				<!-- popup.style.opacity = 0; -->
			};
			
			function showTileset(tilesetLetter) {			
				let mainWindow = window.opener;
				let tilemap = window.opener.SceneManager._scene._spriteset._tilemap;
				
				let tilesets = mainWindow.$dataTilesets[mainWindow.$gameMap._tilesetId].tilesetNames;
				
				let tilesetTileId = 1;
				for ([i, tileset] of tilesets.entries()) {
					if (tileset !== "") {
						if (i < 5 && tilesetLetter === "A") {
							let textureBase = PIXI.Texture.from('img/tilesets/' + tileset + '.png');
							if (i === 0) {
								let setNumbers = [[0, 0], [0, 3], [6, 0], [6, 3], [8, 0], [14, 0], [8, 3], [14, 3], [0, 6], [6, 6], [0, 9], [6, 9], [8, 6], [14, 6], [8, 9], [14, 9]];
								for (let j = 0; j < 16; j++) {
									let line = parseInt(j / 8);
									let col = j - (line * 8);
									let frame = new PIXI.Texture(textureBase, new PIXI.Rectangle(setNumbers[j][0] * 48, setNumbers[j][1] * 48, 48, 48));
									let sprite = new PIXI.Sprite(frame);
									sprite.x = col * 48;
									sprite.y = line * 48;
									sprite.interactive = true;
									sprite.hitArea = new PIXI.Rectangle(0, 0, 48 , 48);
									sprite.tilesetTileId = tilesetTileId;
									sprite.mouseover = function(mouseData) {
										onSpriteMouseOver(mouseData, sprite);
									};								
									sprite.mouseout = function(mouseData) {
										hideTilesetTileId(mouseData);
									}
									app.stage.addChild(sprite);
									tilesetTileId++;
								}
							}
							if (i === 1) {
								for (let j = 0; j < 32; j++) {
									let line = parseInt(j / 8);
									let col = j - (line * 8);
									let frame = new PIXI.Texture(textureBase, new PIXI.Rectangle(col * 2 * 48, line * 3 * 48, 48, 48));
									let sprite = new PIXI.Sprite(frame);
									sprite.x = col * 48;
									sprite.y = line * 48 + (48 * 2);
									sprite.interactive = true;
									sprite.hitArea = new PIXI.Rectangle(0, 0, 48 , 48);
									sprite.tilesetTileId = tilesetTileId;
									sprite.mouseover = function(mouseData) {
										onSpriteMouseOver(mouseData, sprite);
									};								
									sprite.mouseout = function(mouseData) {
										hideTilesetTileId(mouseData);
									}
									app.stage.addChild(sprite);
									tilesetTileId++
								}
							}
							if (i === 2) {
								for (let j = 0; j < 32; j++) {
									let line = parseInt(j / 8);
									let col = j - (line * 8);
									let frame = new PIXI.Texture(textureBase, new PIXI.Rectangle(col * 2 * 48, line * 2 * 48, 48, 48));
									let sprite = new PIXI.Sprite(frame);
									sprite.x = col * 48;
									sprite.y = line * 48 + (48 * 6);
									sprite.interactive = true;
									sprite.hitArea = new PIXI.Rectangle(0, 0, 48 , 48);
									sprite.tilesetTileId = tilesetTileId;
									sprite.mouseover = function(mouseData) {
										onSpriteMouseOver(mouseData, sprite);
									};								
									sprite.mouseout = function(mouseData) {
										hideTilesetTileId(mouseData);
									}
									app.stage.addChild(sprite);
									tilesetTileId++
								}
							}
							if (i === 3) {
								for (let j = 0; j < 48; j++) {
									let line = parseInt(j / 8);
									let col = j % 8;
									let frame = new PIXI.Texture(textureBase, new PIXI.Rectangle(col * 2 * 48, (line % 2) === 0 ? (line / 2 * 5) * 48 : ((parseInt(line / 2) * 5) + 3) * 48, 48, 48));
									let sprite = new PIXI.Sprite(frame);
									sprite.x = col * 48;
									sprite.y = line * 48 + (48 * 10);
									sprite.interactive = true;
									sprite.hitArea = new PIXI.Rectangle(0, 0, 48 , 48);
									sprite.tilesetTileId = tilesetTileId;
									sprite.mouseover = function(mouseData) {
										onSpriteMouseOver(mouseData, sprite);
									};								
									sprite.mouseout = function(mouseData) {
										hideTilesetTileId(mouseData);
									}
									app.stage.addChild(sprite);
									tilesetTileId++
								}
							}
							if (i === 4) {
								for (let y = 0; y < 16; y++) {
									for (let x = 0; x < 8; x++) {
										let frame = new PIXI.Texture(textureBase, new PIXI.Rectangle(x * 48, y * 48, 48, 48));
										let sprite = new PIXI.Sprite(frame);
										sprite.x = x * 48;
										sprite.y = (y * 48) + (48 * 16);
										sprite.interactive = true;
										sprite.hitArea = new PIXI.Rectangle(0, 0, 48 , 48);
										sprite.tilesetTileId = tilesetTileId;
										sprite.mouseover = function(mouseData) {
											onSpriteMouseOver(mouseData, sprite);
										};								
										sprite.mouseout = function(mouseData) {
											hideTilesetTileId(mouseData);
										}
										app.stage.addChild(sprite);
										tilesetTileId++
									}
								}
							}
						} else if (i === 5 && tilesetLetter === "B" || i === 6 && tilesetLetter === "C" || i === 7 && tilesetLetter === "D" || i === 8 && tilesetLetter === "E") {
							let textureBase = PIXI.Texture.from('img/tilesets/' + tileset + '.png');
							for (let page = 0; page < 2; page++) {
								for (let y = 0; y < 16; y++) {
									for (let x = 0; x < 8; x++) {
										let frame = new PIXI.Texture(textureBase, new PIXI.Rectangle((page * 48 * 8) + x * 48, y * 48, 48, 48));
										let sprite = new PIXI.Sprite(frame);
										sprite.x = x * 48;
										sprite.y = y * 48 + (16 * 48 * page);
										sprite.interactive = true;
										sprite.hitArea = new PIXI.Rectangle(0, 0, 48 , 48);
										sprite.tilesetTileId = tilesetTileId;
										sprite.mouseover = function(mouseData) {
											onSpriteMouseOver(mouseData, sprite);
										};								
										sprite.mouseout = function(mouseData) {
											hideTilesetTileId(mouseData);
										}
										app.stage.addChild(sprite);
										tilesetTileId++
									}
								}
							}
							return;
						}
					}
				}
			};
			
			main();
			
			
			window.addEventListener("focus", function(event) { 
				refreshView();
			}, false);
			
			window.addEventListener("keydown", function(event) {
				if (!event.ctrlKey && !event.altKey) {
					switch (event.keyCode) {
						case 116: // F5
							window.opener.SceneManager.reloadGame();
							break;
						case 119: // F8
							window.opener.SceneManager.showDevTools();
							break;
					}
				}
			});
		</script>
    </body>
</html>